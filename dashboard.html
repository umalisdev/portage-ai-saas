<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portage AI ‚Äî Sales Force Command Center</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg-primary: #0a0b0f;
      --bg-secondary: #10111a;
      --bg-card: #181920;
      --bg-input: #12131a;
      --border: #1e1f2e;
      --border-hover: #2a2b3a;
      --text-primary: #e8e9f0;
      --text-secondary: #8b8ca0;
      --text-muted: #5c5d70;
      --text-dim: #3d3e50;
      --accent-blue: #3b82f6;
      --accent-green: #10b981;
      --accent-yellow: #f59e0b;
      --accent-purple: #8b5cf6;
      --accent-red: #f43f5e;
      --accent-cyan: #06b6d4;
      --accent-linkedin: #0077b5;
      --sidebar-width: 240px;
      --sidebar-collapsed: 64px;
      --header-height: 0px;
    }
    /* ===== LIGHT THEME ===== */
    [data-theme="light"] {
      --bg-primary: #f5f6fa;
      --bg-secondary: #ffffff;
      --bg-card: #ffffff;
      --bg-input: #f0f1f5;
      --border: #e2e4ea;
      --border-hover: #d0d2da;
      --text-primary: #1a1b2e;
      --text-secondary: #5c5d70;
      --text-muted: #8b8ca0;
      --text-dim: #b0b1c0;
      --accent-blue: #2563eb;
      --accent-green: #059669;
      --accent-yellow: #d97706;
      --accent-purple: #7c3aed;
      --accent-red: #e11d48;
      --accent-cyan: #0891b2;
      --accent-linkedin: #0066a0;
    }
    [data-theme="light"] .sidebar { box-shadow: 2px 0 8px rgba(0,0,0,0.06); }
    [data-theme="light"] .kpi-card,
    [data-theme="light"] .modal,
    [data-theme="light"] .profile-card { box-shadow: 0 1px 4px rgba(0,0,0,0.06); }
    [data-theme="light"] ::-webkit-scrollbar-thumb { background: #d0d2da; }
    [data-theme="light"] ::-webkit-scrollbar-thumb:hover { background: #b0b1c0; }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      overflow: hidden;
      height: 100vh;
    }
    /* Layout */
    .app-layout { display: flex; height: 100vh; }
    .sidebar {
      width: var(--sidebar-width);
      background: var(--bg-secondary);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      transition: width 0.25s ease;
      overflow: hidden;
      flex-shrink: 0;
    }
    .sidebar.collapsed { width: var(--sidebar-collapsed); }
    .sidebar-header {
      padding: 20px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      border-bottom: 1px solid var(--border);
      min-height: 68px;
    }
    .sidebar-logo {
      width: 36px; height: 36px;
      background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
    }
    .sidebar-logo .material-icons-round { font-size: 20px; color: #fff; }
    .sidebar-brand { white-space: nowrap; overflow: hidden; }
    .sidebar-brand h2 { font-size: 15px; font-weight: 800; color: var(--text-primary); letter-spacing: -0.3px; }
    .sidebar-brand span { font-size: 10px; color: var(--text-muted); font-weight: 500; }
    .sidebar.collapsed .sidebar-brand { display: none; }
    .sidebar-nav { flex: 1; padding: 12px 8px; overflow-y: auto; }
    .nav-section { margin-bottom: 16px; }
    .nav-section-title {
      font-size: 10px; font-weight: 700; text-transform: uppercase;
      letter-spacing: 1px; color: var(--text-dim); padding: 4px 12px 8px;
    }
    .sidebar.collapsed .nav-section-title { display: none; }
    .nav-item {
      display: flex; align-items: center; gap: 10px;
      padding: 9px 12px; border-radius: 10px; cursor: pointer;
      transition: all 0.15s ease; color: var(--text-secondary);
      text-decoration: none; position: relative; margin-bottom: 2px;
    }
    .nav-item:hover { background: rgba(59,130,246,0.06); color: var(--text-primary); }
    .nav-item.active {
      background: rgba(59,130,246,0.1);
      color: var(--accent-blue);
    }
    .nav-item.active::before {
      content: ''; position: absolute; left: 0; top: 50%; transform: translateY(-50%);
      width: 3px; height: 20px; background: var(--accent-blue); border-radius: 0 3px 3px 0;
    }
    .nav-item .material-icons-round { font-size: 20px; flex-shrink: 0; }
    .nav-item span { font-size: 13px; font-weight: 500; white-space: nowrap; }
    .sidebar.collapsed .nav-item span { display: none; }
    .sidebar.collapsed .nav-item { justify-content: center; padding: 10px; }
    .nav-badge {
      margin-left: auto; font-size: 10px; font-weight: 700;
      background: var(--accent-blue); color: #fff;
      padding: 2px 7px; border-radius: 10px;
    }
    .sidebar.collapsed .nav-badge { display: none; }
    .sidebar-footer {
      padding: 12px 8px; border-top: 1px solid var(--border);
    }
    .sidebar-toggle {
      display: flex; align-items: center; justify-content: center;
      gap: 8px; padding: 8px; border-radius: 8px; cursor: pointer;
      color: var(--text-muted); transition: all 0.15s; border: none;
      background: transparent; width: 100%;
    }
    .sidebar-toggle:hover { background: rgba(255,255,255,0.04); color: var(--text-secondary); }
    /* Main content */
    .main-content {
      flex: 1; overflow-y: auto; overflow-x: hidden;
      background: var(--bg-primary);
    }
    .page { display: none; padding: 28px 32px; min-height: 100vh; }
    .page.active { display: block; }
    .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 28px; }
    .page-title { font-size: 26px; font-weight: 800; letter-spacing: -0.5px; }
    .page-subtitle { font-size: 13px; color: var(--text-muted); margin-top: 2px; }
    .live-badge {
      display: flex; align-items: center; gap: 6px;
      background: rgba(16,185,129,0.1); padding: 6px 14px; border-radius: 20px;
    }
    .live-dot { width: 7px; height: 7px; border-radius: 50%; background: var(--accent-green); animation: pulse 2s infinite; }
    @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.4; } }
    .live-badge span { font-size: 12px; font-weight: 600; color: var(--accent-green); }
    /* KPI Grid */
    .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 14px; margin-bottom: 24px; }
    .kpi-card {
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 14px; padding: 18px;
      transition: border-color 0.2s, transform 0.15s;
    }
    .kpi-card:hover { border-color: var(--border-hover); transform: translateY(-1px); }
    .kpi-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .kpi-icon {
      width: 36px; height: 36px; border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
    }
    .kpi-icon .material-icons-round { font-size: 18px; }
    .kpi-trend { font-size: 12px; font-weight: 600; }
    .kpi-trend.up { color: var(--accent-green); }
    .kpi-trend.down { color: var(--accent-red); }
    .kpi-value { font-size: 28px; font-weight: 800; margin-bottom: 2px; }
    .kpi-label { font-size: 12px; color: var(--text-muted); }
    /* Panels / Cards */
    .panel {
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 14px; padding: 20px; margin-bottom: 16px;
    }
    .panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .panel-title { font-size: 15px; font-weight: 700; }
    .panel-badge {
      font-size: 11px; font-weight: 600; padding: 3px 10px; border-radius: 8px;
    }
    /* Grid layouts */
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px; }
    .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin-bottom: 16px; }
    .grid-5-3 { display: grid; grid-template-columns: 3fr 2fr; gap: 16px; margin-bottom: 16px; }
    /* Charts */
    .chart-container { position: relative; height: 220px; }
    /* Funnel */
    .funnel-step { display: flex; align-items: center; gap: 12px; padding: 10px 0; }
    .funnel-bar-bg { flex: 1; height: 28px; background: var(--bg-input); border-radius: 6px; overflow: hidden; position: relative; }
    .funnel-bar { height: 100%; border-radius: 6px; transition: width 0.6s ease; display: flex; align-items: center; padding-left: 10px; }
    .funnel-bar span { font-size: 11px; font-weight: 700; color: #fff; white-space: nowrap; }
    .funnel-label { font-size: 12px; color: var(--text-secondary); width: 100px; flex-shrink: 0; }
    .funnel-count { font-size: 13px; font-weight: 700; width: 50px; text-align: right; flex-shrink: 0; }
    .funnel-rate { font-size: 11px; color: var(--text-muted); width: 40px; text-align: right; flex-shrink: 0; }
    /* Activity feed */
    .activity-item { display: flex; gap: 10px; padding: 10px 0; border-bottom: 1px solid rgba(30,31,46,0.5); }
    .activity-item:last-child { border-bottom: none; }
    .activity-dot { width: 8px; height: 8px; border-radius: 50%; margin-top: 5px; flex-shrink: 0; }
    .activity-time { font-size: 11px; color: var(--text-muted); width: 42px; flex-shrink: 0; }
    .activity-text { font-size: 12px; color: var(--text-secondary); line-height: 1.5; }
    .activity-agent { font-weight: 600; }
    /* Leaderboard */
    .leader-row { display: flex; align-items: center; gap: 10px; padding: 10px 0; border-bottom: 1px solid rgba(30,31,46,0.5); }
    .leader-row:last-child { border-bottom: none; }
    .leader-rank { font-size: 14px; font-weight: 800; width: 24px; text-align: center; }
    .leader-avatar { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px; overflow: hidden; border: 2px solid rgba(255,255,255,0.8); box-shadow: 0 1px 4px rgba(0,0,0,0.1); }
    .leader-avatar img { width: 100%; height: 100%; object-fit: cover; }
    .leader-info { flex: 1; }
    .leader-name { font-size: 13px; font-weight: 600; }
    .leader-role { font-size: 11px; color: var(--text-muted); }
    .leader-score { font-size: 15px; font-weight: 800; }
    .leader-bar-bg { width: 80px; height: 4px; background: var(--bg-input); border-radius: 2px; overflow: hidden; }
    .leader-bar { height: 100%; border-radius: 2px; }
    /* Agent cards */
    .agent-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 16px; }
    .agent-card {
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 14px; padding: 20px; cursor: pointer;
      transition: all 0.2s;
    }
    .agent-card:hover { border-color: var(--border-hover); transform: translateY(-2px); }
    .agent-header { display: flex; align-items: center; gap: 14px; margin-bottom: 16px; }
    .agent-avatar {
      width: 48px; height: 48px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 24px;
      overflow: hidden;
      border: 2px solid rgba(255,255,255,0.8);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .agent-avatar img {
      width: 100%; height: 100%; object-fit: cover;
    }
    .agent-name { font-size: 16px; font-weight: 700; }
    .agent-role { font-size: 12px; color: var(--text-muted); }
    .agent-status {
      font-size: 10px; font-weight: 600; padding: 3px 8px; border-radius: 6px;
      margin-left: auto;
    }
    .agent-metrics { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 14px; }
    .agent-metric { text-align: center; }
    .agent-metric-val { font-size: 18px; font-weight: 800; }
    .agent-metric-lbl { font-size: 10px; color: var(--text-muted); }
    .agent-specialties { display: flex; flex-wrap: wrap; gap: 6px; }
    .agent-specialty {
      font-size: 10px; font-weight: 600; padding: 4px 8px;
      background: var(--bg-input); border-radius: 6px; color: var(--text-secondary);
    }
    /* Pipeline */
    .pipeline-table { width: 100%; }
    .pipeline-row {
      display: grid; grid-template-columns: 2fr 1.2fr 1fr 1fr 1fr;
      align-items: center; padding: 12px 0; gap: 12px;
      border-bottom: 1px solid rgba(30,31,46,0.3);
    }
    .pipeline-row:last-child { border-bottom: none; }
    .pipeline-row.header { color: var(--text-muted); font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
    .pipeline-name { font-size: 13px; font-weight: 600; }
    .pipeline-sector { font-size: 11px; color: var(--text-muted); }
    .stage-badge { font-size: 11px; font-weight: 600; padding: 4px 10px; border-radius: 8px; text-align: center; display: inline-block; }
    .pipeline-value { font-size: 13px; font-weight: 700; }
    .pipeline-agent { display: flex; align-items: center; gap: 4px; font-size: 11px; font-weight: 600; padding: 4px 8px; border-radius: 8px; }
    /* Buttons */
    .btn {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 10px 18px; border-radius: 10px; font-size: 13px;
      font-weight: 700; border: none; cursor: pointer;
      transition: all 0.15s;
    }
    .btn:hover { transform: translateY(-1px); }
    .btn:active { transform: translateY(0); }
    .btn-primary { background: var(--accent-blue); color: #fff; }
    .btn-primary:hover { background: #2563eb; }
    .btn-success { background: var(--accent-green); color: #fff; }
    .btn-linkedin { background: var(--accent-linkedin); color: #fff; }
    /* Filter tabs */
    .filter-tabs { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
    .filter-tab {
      padding: 7px 14px; border-radius: 8px; font-size: 12px;
      font-weight: 600; cursor: pointer; border: none;
      background: var(--bg-input); color: var(--text-muted);
      transition: all 0.15s;
    }
    .filter-tab:hover { color: var(--text-secondary); }
    .filter-tab.active { background: var(--accent-blue); color: #fff; }
    /* Forms */
    .form-group { margin-bottom: 16px; }
    .form-label { display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px; }
    .form-input {
      width: 100%; padding: 11px 14px; background: var(--bg-input);
      border: 1px solid var(--border); border-radius: 10px;
      color: var(--text-primary); font-size: 14px; font-weight: 500;
      font-family: inherit; outline: none; transition: border-color 0.2s;
    }
    .form-input:focus { border-color: var(--accent-blue); }
    .form-input::placeholder { color: var(--text-dim); }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    /* Simulateur */
    .sim-result-card {
      background: linear-gradient(135deg, rgba(59,130,246,0.08), rgba(139,92,246,0.08));
      border: 1px solid rgba(59,130,246,0.2); border-radius: 14px;
      padding: 24px; text-align: center; margin-top: 20px;
    }
    .sim-result-value { font-size: 42px; font-weight: 900; color: var(--accent-blue); }
    .sim-result-label { font-size: 13px; color: var(--text-secondary); margin-top: 4px; }
    .sim-breakdown { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-top: 16px; }
    .sim-breakdown-item { text-align: center; padding: 12px; background: var(--bg-card); border-radius: 10px; border: 1px solid var(--border); }
    .sim-breakdown-val { font-size: 18px; font-weight: 700; }
    .sim-breakdown-lbl { font-size: 10px; color: var(--text-muted); margin-top: 2px; }
    /* CRM */
    .crm-card {
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 14px; padding: 18px; margin-bottom: 12px;
      transition: all 0.2s;
    }
    .crm-card:hover { border-color: var(--border-hover); }
    .crm-header { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
    .crm-avatar {
      width: 40px; height: 40px; border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      font-size: 16px; font-weight: 700;
    }
    .crm-name { font-size: 14px; font-weight: 700; }
    .crm-email { font-size: 11px; color: var(--text-muted); }
    .crm-meta { display: flex; gap: 12px; flex-wrap: wrap; }
    .crm-tag { font-size: 10px; font-weight: 600; padding: 3px 8px; border-radius: 6px; }
    /* Campaign cards */
    .campaign-card {
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 14px; padding: 18px; margin-bottom: 12px;
    }
    .campaign-metrics { display: flex; justify-content: space-between; margin: 14px 0; }
    .campaign-metric { text-align: center; }
    .campaign-metric-val { font-size: 16px; font-weight: 700; }
    .campaign-metric-lbl { font-size: 10px; color: var(--text-muted); }
    .progress-bar { height: 4px; background: var(--bg-input); border-radius: 2px; overflow: hidden; margin: 10px 0; }
    .progress-fill { height: 100%; border-radius: 2px; transition: width 0.4s; }
    /* Mission cards */
    .mission-card {
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 14px; padding: 18px; border-left: 3px solid;
    }
    .mission-progress { margin: 12px 0; }
    .mission-progress-header { display: flex; justify-content: space-between; margin-bottom: 6px; }
    .mission-progress-label { font-size: 12px; color: var(--text-secondary); }
    .mission-progress-pct { font-size: 13px; font-weight: 700; }
    /* Config */
    .config-section {
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 14px; padding: 20px; margin-bottom: 16px;
    }
    .config-section-header { display: flex; align-items: center; gap: 8px; margin-bottom: 4px; }
    .config-section-title { font-size: 16px; font-weight: 700; }
    .config-section-desc { font-size: 12px; color: var(--text-muted); margin-bottom: 16px; }
    .config-row {
      display: flex; align-items: center; gap: 10px;
      padding: 10px 0; border-bottom: 1px solid rgba(30,31,46,0.5);
    }
    .config-row:last-child { border-bottom: none; }
    .switch {
      position: relative; width: 40px; height: 22px;
      background: var(--border-hover); border-radius: 11px;
      cursor: pointer; transition: background 0.2s; flex-shrink: 0;
    }
    .switch.on { background: var(--accent-blue); }
    .switch::after {
      content: ''; position: absolute; top: 2px; left: 2px;
      width: 18px; height: 18px; border-radius: 50%;
      background: #fff; transition: transform 0.2s;
    }
    .switch.on::after { transform: translateX(18px); }
    .integration-btn {
      font-size: 11px; font-weight: 600; padding: 5px 12px;
      border-radius: 8px; border: 1px solid; cursor: pointer;
      background: transparent;
    }
    /* Search */
    .search-box {
      display: flex; align-items: center; gap: 8px;
      background: var(--bg-input); border: 1px solid var(--border);
      border-radius: 10px; padding: 0 14px; margin-bottom: 16px;
    }
    .search-box .material-icons-round { font-size: 18px; color: var(--text-muted); }
    .search-box input {
      flex: 1; padding: 11px 0; background: transparent; border: none;
      color: var(--text-primary); font-size: 14px; font-family: inherit; outline: none;
    }
    .search-box input::placeholder { color: var(--text-dim); }
    /* LinkedIn profiles */
    .profile-card {
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 14px; padding: 18px; margin-bottom: 12px;
    }
    .profile-header { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
    .profile-avatar {
      width: 44px; height: 44px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 18px; font-weight: 700; background: rgba(59,130,246,0.15); color: var(--accent-blue);
    }
    .profile-score { font-size: 22px; font-weight: 800; text-align: center; }
    .profile-skills { display: flex; flex-wrap: wrap; gap: 6px; margin: 10px 0; }
    .profile-skill { font-size: 10px; font-weight: 600; padding: 4px 8px; background: var(--bg-input); border-radius: 6px; color: var(--text-secondary); }
    /* Notification toast */
    .toast {
      position: fixed; top: 20px; right: 20px; z-index: 1000;
      background: var(--bg-card); border: 1px solid var(--accent-green);
      border-radius: 12px; padding: 14px 20px;
      display: flex; align-items: center; gap: 10px;
      transform: translateX(120%); transition: transform 0.3s ease;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    }
    .toast.show { transform: translateX(0); }
    .toast-icon { font-size: 20px; color: var(--accent-green); }
    .toast-text { font-size: 13px; font-weight: 500; }
    .toast-text strong { font-weight: 700; }
    /* Modal */
    .modal-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.6);
      display: none; align-items: center; justify-content: center; z-index: 999;
      backdrop-filter: blur(4px);
    }
    .modal-overlay.show { display: flex; }
    .modal {
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 16px; padding: 28px; width: 90%; max-width: 500px;
      max-height: 85vh; overflow-y: auto;
    }
    .modal-title { font-size: 18px; font-weight: 800; margin-bottom: 4px; }
    .modal-subtitle { font-size: 12px; color: var(--text-muted); margin-bottom: 20px; }
    /* Theme Toggle Button */
    .theme-toggle-container {
      position: fixed;
      top: 16px;
      right: 24px;
      z-index: 200;
    }
    .theme-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 30px;
      padding: 6px 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      color: var(--text-secondary);
      font-family: 'Inter', sans-serif;
      font-size: 12px;
      font-weight: 600;
    }
    .theme-toggle:hover {
      border-color: var(--accent-blue);
      color: var(--accent-blue);
      transform: scale(1.03);
    }
    .theme-toggle .material-icons-round {
      font-size: 18px;
      transition: transform 0.3s ease;
    }
    .theme-toggle:hover .material-icons-round {
      transform: rotate(30deg);
    }
    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--border-hover); }
    /* Responsive */
    @media (max-width: 1024px) {
      .grid-2, .grid-5-3 { grid-template-columns: 1fr; }
      .grid-3 { grid-template-columns: 1fr 1fr; }
    }
    @media (max-width: 768px) {
      .sidebar { position: fixed; z-index: 100; width: var(--sidebar-collapsed); }
      .sidebar .sidebar-brand, .sidebar .nav-item span, .sidebar .nav-badge, .sidebar .nav-section-title { display: none; }
      .sidebar .nav-item { justify-content: center; padding: 10px; }
      .main-content { margin-left: var(--sidebar-collapsed); }
      .page { padding: 16px; }
      .kpi-grid { grid-template-columns: repeat(2, 1fr); }
      .pipeline-row { grid-template-columns: 1fr 1fr; }
    }
  </style>
</head>
<body>
<div class="app-layout">
  <!-- SIDEBAR -->
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-logo"><span class="material-icons-round">auto_awesome</span></div>
      <div class="sidebar-brand">
        <h2>Portage AI</h2>
        <span>Sales Force Command Center</span>
      </div>
    </div>
    <div class="sidebar-nav">
      <div class="nav-section">
        <div class="nav-section-title">Principal</div>
        <div class="nav-item active" data-page="dashboard" onclick="navigate('dashboard')">
          <span class="material-icons-round">dashboard</span><span>Dashboard</span>
        </div>
        <div class="nav-item" data-page="agents" onclick="navigate('agents')">
          <span class="material-icons-round">smart_toy</span><span>Agents IA</span>
          <div class="nav-badge">5</div>
        </div>
      </div>
      <div class="nav-section">
        <div class="nav-section-title">Pipelines</div>
        <div class="nav-item" data-page="b2b" onclick="navigate('b2b')">
          <span class="material-icons-round">business</span><span>Pipeline B2B</span>
        </div>
        <div class="nav-item" data-page="b2c" onclick="navigate('b2c')">
          <span class="material-icons-round">people</span><span>Pipeline B2C</span>
        </div>
        <div class="nav-item" data-page="crm" onclick="navigate('crm')">
          <span class="material-icons-round">contact_page</span><span>CRM</span>
          <div class="nav-badge" id="crm-badge">0</div>
        </div>
      </div>
      <div class="nav-section">
        <div class="nav-section-title">Outils</div>
        <div class="nav-item" data-page="simulateur" onclick="navigate('simulateur')">
          <span class="material-icons-round">calculate</span><span>Simulateur</span>
        </div>
        <div class="nav-item" data-page="campagnes" onclick="navigate('campagnes')">
          <span class="material-icons-round">campaign</span><span>Campagnes</span>
        </div>
        <div class="nav-item" data-page="linkedin" onclick="navigate('linkedin')">
          <span class="material-icons-round">work</span><span>LinkedIn</span>
        </div>
        <div class="nav-item" data-page="missions" onclick="navigate('missions')">
          <span class="material-icons-round">assignment</span><span>Missions</span>
        </div>
      </div>
      <div class="nav-section">
        <div class="nav-section-title">Strat√©gie</div>
        <div class="nav-item" data-page="strategie" onclick="navigate('strategie')">
          <span class="material-icons-round">architecture</span><span>√âtude & Architecture</span>
        </div>
        <div class="nav-item" data-page="presentation" onclick="navigate('presentation')">
          <span class="material-icons-round">slideshow</span><span>Pr√©sentation</span>
        </div>
      </div>
      <div class="nav-section">
        <div class="nav-section-title">Syst√®me</div>
        <div class="nav-item" data-page="config" onclick="navigate('config')">
          <span class="material-icons-round">settings</span><span>Configuration</span>
        </div>
      </div>
    </div>
    <div class="sidebar-footer">
      <button class="sidebar-toggle" onclick="toggleSidebar()">
        <span class="material-icons-round" id="toggle-icon">chevron_left</span>
      </button>
    </div>
  </nav>

  <!-- THEME TOGGLE -->
  <div class="theme-toggle-container">
    <button class="theme-toggle" id="theme-toggle" onclick="toggleTheme()">
      <span class="material-icons-round" id="theme-icon">light_mode</span>
      <span id="theme-label">Mode Clair</span>
    </button>
  </div>

  <!-- MAIN CONTENT -->
  <div class="main-content" id="main-content">
</div>
</div>

<!-- Toast notification -->
<div class="toast" id="toast">
  <span class="material-icons-round toast-icon">check_circle</span>
  <div class="toast-text" id="toast-text"></div>
</div>

<!-- Mission Modal -->
<div class="modal-overlay" id="mission-modal">
  <div class="modal">
    <div class="modal-title">Nouvelle Mission</div>
    <div class="modal-subtitle">Cr√©er une mission pour un agent IA</div>
    <div class="form-group">
      <label class="form-label">Titre de la mission</label>
      <input class="form-input" id="mission-title" placeholder="Ex: Prospection ESN Lyon">
    </div>
    <div class="form-group">
      <label class="form-label">Description</label>
      <textarea class="form-input" id="mission-desc" rows="3" placeholder="D√©crivez l'objectif..."></textarea>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Agent assign√©</label>
        <select class="form-input" id="mission-agent">
          <option value="aria">üîç ARIA</option>
          <option value="noah">ü§ù NOAH</option>
          <option value="luna">‚ú® LUNA</option>
          <option value="alex">üéØ ALEX</option>
          <option value="max">üìä MAX</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Priorit√©</label>
        <select class="form-input" id="mission-priority">
          <option value="haute">Haute</option>
          <option value="moyenne">Moyenne</option>
          <option value="basse">Basse</option>
        </select>
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">√âch√©ance</label>
      <input class="form-input" type="date" id="mission-deadline">
    </div>
    <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:20px;">
      <button class="btn" style="background:var(--bg-input);color:var(--text-secondary);" onclick="closeMissionModal()">Annuler</button>
      <button class="btn btn-primary" onclick="createMission()">Cr√©er la mission</button>
    </div>
  </div>
</div>

<script>
// ===== DATA =====
const AGENTS = [
  { id:'aria', name:'ARIA', fullName:'Agent de Recherche et Intelligence Artificielle', role:'Prospection & Qualification', emoji:'üîç', photo:'img/aria.png', color:'#3b82f6', bg:'rgba(59,130,246,0.12)', status:'active', score:94, contacts:487, deals:23, specialties:['Scraping LinkedIn','Scoring IA','Qualification auto'], weeklyData:[42,38,55,48,62,45,52] },
  { id:'noah', name:'NOAH', fullName:'N√©gociateur Optimis√© par Algorithmes Heuristiques', role:'N√©gociation & Closing', emoji:'ü§ù', photo:'img/noah.png', color:'#10b981', bg:'rgba(16,185,129,0.12)', status:'active', score:91, contacts:234, deals:18, specialties:['Closing B2B','N√©gociation','Contrats-cadres'], weeklyData:[28,35,42,38,45,40,48] },
  { id:'luna', name:'LUNA', fullName:'Logiciel Unifi√© de Nurturing Automatis√©', role:'Marketing & Nurturing', emoji:'‚ú®', photo:'img/luna.png', color:'#f59e0b', bg:'rgba(245,158,11,0.12)', status:'busy', score:88, contacts:1205, deals:45, specialties:['Email marketing','S√©quences auto','Content IA'], weeklyData:[85,92,78,95,88,102,96] },
  { id:'alex', name:'ALEX', fullName:'Agent Logistique d\'EXp√©rience client', role:'Onboarding & Fid√©lisation', emoji:'üéØ', photo:'img/alex.png', color:'#8b5cf6', bg:'rgba(139,92,246,0.12)', status:'active', score:86, contacts:312, deals:67, specialties:['Onboarding','Satisfaction','R√©tention'], weeklyData:[35,42,38,45,40,48,44] },
  { id:'max', name:'MAX', fullName:'Module d\'Analyse et eXploitation des donn√©es', role:'Analytics & Reporting', emoji:'üìä', photo:'img/max.png', color:'#f43f5e', bg:'rgba(244,63,94,0.12)', status:'idle', score:92, contacts:0, deals:0, specialties:['Dashboards','Pr√©dictions','Rapports auto'], weeklyData:[12,15,18,14,20,16,22] }
];

const B2B_PIPELINE = [
  { name:'Capgemini Engineering', sector:'ESN', stage:'N√©gociation', value:25000, agent:'noah' },
  { name:'Sopra Steria', sector:'ESN', stage:'Proposition', value:18000, agent:'aria' },
  { name:'Accenture France', sector:'Conseil', stage:'Qualification', value:32000, agent:'aria' },
  { name:'Alten', sector:'Ing√©nierie', stage:'Closing', value:15000, agent:'noah' },
  { name:'CGI France', sector:'ESN', stage:'D√©couverte', value:22000, agent:'aria' },
  { name:'Devoteam', sector:'Conseil IT', stage:'Proposition', value:12000, agent:'noah' },
  { name:'Atos', sector:'ESN', stage:'N√©gociation', value:28000, agent:'noah' },
  { name:'Wavestone', sector:'Conseil', stage:'Qualification', value:8000, agent:'aria' }
];

const B2C_PIPELINE = [
  { name:'Thomas Durand', sector:'DevOps', stage:'Simulation', value:650, agent:'luna' },
  { name:'Sophie Martin', sector:'SAP', stage:'Onboarding', value:720, agent:'alex' },
  { name:'Pierre Lambert', sector:'Cloud', stage:'Qualification', value:800, agent:'luna' },
  { name:'Marie Chevalier', sector:'Data', stage:'Contact', value:580, agent:'luna' },
  { name:'Jean Rousseau', sector:'PM', stage:'Simulation', value:600, agent:'alex' },
  { name:'Claire Bonnet', sector:'UX', stage:'Onboarding', value:550, agent:'alex' },
  { name:'Karim Amrani', sector:'IA/ML', stage:'Contact', value:900, agent:'aria' },
  { name:'Nadia Faure', sector:'Formation', stage:'Sign√©', value:450, agent:'alex' }
];

const ACTIVITIES = [
  { time:'14:32', agent:'ARIA', text:'a qualifi√© 3 nouveaux leads B2B dans le secteur ESN', color:'#3b82f6' },
  { time:'14:15', agent:'NOAH', text:'a envoy√© une proposition commerciale √† Capgemini Engineering', color:'#10b981' },
  { time:'13:58', agent:'LUNA', text:'a lanc√© la campagne email "D√©couvrez le portage salarial"', color:'#f59e0b' },
  { time:'13:42', agent:'ALEX', text:'a finalis√© l\'onboarding de Sophie Martin (SAP)', color:'#8b5cf6' },
  { time:'13:20', agent:'MAX', text:'a g√©n√©r√© le rapport de performance hebdomadaire', color:'#f43f5e' },
  { time:'12:55', agent:'ARIA', text:'a identifi√© 12 profils LinkedIn Data/IA √† contacter', color:'#3b82f6' },
  { time:'12:30', agent:'LUNA', text:'a envoy√© 450 emails de nurturing aux leads B2C', color:'#f59e0b' },
  { time:'11:45', agent:'NOAH', text:'a programm√© un RDV closing avec Alten pour vendredi', color:'#10b981' }
];

const DASHBOARD_FUNNEL = [
  { label:'Contacts', count:2057, rate:'100%', color:'#3b82f6' },
  { label:'Qualifi√©s', count:666, rate:'32%', color:'#8b5cf6' },
  { label:'Propositions', count:307, rate:'15%', color:'#f59e0b' },
  { label:'N√©gociation', count:142, rate:'6.9%', color:'#06b6d4' },
  { label:'Sign√©s', count:89, rate:'4.3%', color:'#10b981' }
];

const B2B_FUNNEL = [
  { label:'D√©couverte', count:45, rate:'100%', color:'#3b82f6' },
  { label:'Qualification', count:28, rate:'62%', color:'#8b5cf6' },
  { label:'Proposition', count:18, rate:'40%', color:'#f59e0b' },
  { label:'N√©gociation', count:12, rate:'27%', color:'#06b6d4' },
  { label:'Closing', count:8, rate:'18%', color:'#10b981' }
];

const B2C_FUNNEL = [
  { label:'Contact', count:1200, rate:'100%', color:'#3b82f6' },
  { label:'Simulation', count:420, rate:'35%', color:'#8b5cf6' },
  { label:'Qualification', count:180, rate:'15%', color:'#f59e0b' },
  { label:'Onboarding', count:85, rate:'7%', color:'#06b6d4' },
  { label:'Sign√©', count:52, rate:'4.3%', color:'#10b981' }
];

const CAMPAIGNS = [
  { name:'D√©couvrez vos revenus en portage', agent:'LUNA', agentEmoji:'‚ú®', status:'active', type:'email', sent:2400, opened:864, clicked:312, replies:48, meetings:12, target:'Freelances IT' },
  { name:'Offre entreprise ‚Äî Contrat-cadre', agent:'ARIA', agentEmoji:'üîç', status:'active', type:'multicanal', sent:450, opened:198, clicked:67, replies:23, meetings:8, target:'DSI Grands Comptes' },
  { name:'Webinaire Portage vs Auto-entrepreneur', agent:'LUNA', agentEmoji:'‚ú®', status:'completed', type:'email', sent:3200, opened:1280, clicked:576, replies:89, meetings:34, target:'Ind√©pendants' },
  { name:'Relance prospects qualifi√©s Q1', agent:'NOAH', agentEmoji:'ü§ù', status:'active', type:'email', sent:180, opened:108, clicked:45, replies:18, meetings:6, target:'Prospects B2B chauds' },
  { name:'Nurturing nouveaux inscrits', agent:'ALEX', agentEmoji:'üéØ', status:'draft', type:'email', sent:0, opened:0, clicked:0, replies:0, meetings:0, target:'Nouveaux leads B2C' },
  { name:'Prospection LinkedIn ESN', agent:'ARIA', agentEmoji:'üîç', status:'paused', type:'linkedin', sent:320, opened:160, clicked:48, replies:15, meetings:4, target:'ESN & SSII' }
];

const LINKEDIN_PROFILES = [
  { name:'Thomas Durand', title:'DevOps Senior', company:'Freelance', location:'Paris', score:92, status:'interested', agent:'LUNA', skills:['AWS','Kubernetes','Terraform'], tjm:650 },
  { name:'Sophie Martin', title:'Consultante SAP', company:'Accenture', location:'Lyon', score:88, status:'meeting', agent:'ALEX', skills:['SAP S/4HANA','ABAP','Fiori'], tjm:720 },
  { name:'Pierre Lambert', title:'Architecte Cloud', company:'Capgemini', location:'Nantes', score:85, status:'contacted', agent:'LUNA', skills:['Azure','GCP','Microservices'], tjm:800 },
  { name:'Marie Chevalier', title:'Data Analyst', company:'Freelance', location:'Bordeaux', score:78, status:'new', agent:'ARIA', skills:['Python','Power BI','SQL'], tjm:580 },
  { name:'Jean Rousseau', title:'Chef de Projet IT', company:'Sopra Steria', location:'Toulouse', score:82, status:'contacted', agent:'LUNA', skills:['Agile','JIRA','PMO'], tjm:600 },
  { name:'Claire Bonnet', title:'UX Designer Senior', company:'Freelance', location:'Paris', score:90, status:'interested', agent:'ALEX', skills:['Figma','Design System','User Research'], tjm:550 },
  { name:'Karim Amrani', title:'Ing√©nieur IA/ML', company:'Thales', location:'Paris', score:95, status:'new', agent:'ARIA', skills:['PyTorch','NLP','MLOps'], tjm:900 },
  { name:'Nadia Faure', title:'Formatrice Digitale', company:'Freelance', location:'Marseille', score:72, status:'converted', agent:'ALEX', skills:['E-learning','Moodle','P√©dagogie'], tjm:450 }
];

const MISSIONS = [
  { title:'Prospection ESN √éle-de-France', desc:'Identifier et qualifier 50 ESN en IDF pour proposer des contrats-cadres.', agent:'aria', priority:'haute', status:'en_cours', progress:68, target:'50 ESN qualifi√©es', deadline:'28/02/2026', metrics:[{l:'Identifi√©es',v:'42'},{l:'Contact√©es',v:'34'},{l:'Qualifi√©es',v:'18'}] },
  { title:'Campagne Webinaire Mars 2026', desc:'Organiser un webinaire "Portage vs Auto-entrepreneur" ‚Äî 200 inscrits.', agent:'luna', priority:'haute', status:'planifiee', progress:25, target:'200 inscrits', deadline:'15/03/2026', metrics:[{l:'Landing page',v:'OK'},{l:'Inscrits',v:'52'},{l:'Emails',v:'1200'}] },
  { title:'Closing Capgemini Engineering', desc:'Finaliser la n√©gociation du contrat-cadre ‚Äî 25K‚Ç¨/mois.', agent:'noah', priority:'haute', status:'en_cours', progress:85, target:'Signature contrat', deadline:'22/02/2026', metrics:[{l:'R√©unions',v:'4'},{l:'Proposition',v:'Envoy√©e'},{l:'Retour',v:'Positif'}] },
  { title:'Onboarding batch f√©vrier', desc:'Accompagner l\'onboarding de 12 nouveaux consultants.', agent:'alex', priority:'moyenne', status:'en_cours', progress:58, target:'12 consultants actifs', deadline:'28/02/2026', metrics:[{l:'Inscrits',v:'12'},{l:'Simulation OK',v:'8'},{l:'Contrats',v:'7'}] },
  { title:'Rapport performance Q1', desc:'G√©n√©rer le rapport trimestriel avec analyse pr√©dictive.', agent:'max', priority:'basse', status:'planifiee', progress:10, target:'Rapport complet', deadline:'31/03/2026', metrics:[{l:'Donn√©es',v:'40%'},{l:'Analyses',v:'En cours'}] },
  { title:'Prospection LinkedIn Data/IA', desc:'Rechercher et contacter 30 profils Data/IA seniors.', agent:'aria', priority:'moyenne', status:'terminee', progress:100, target:'30 profils contact√©s', deadline:'15/02/2026', metrics:[{l:'Trouv√©s',v:'35'},{l:'Contact√©s',v:'30'},{l:'R√©ponses',v:'12'}] }
];

// CRM Prospects (populated by simulator)
let CRM_PROSPECTS = [];
let simCounter = 0;

// ===== HELPERS =====
function getAgent(id) { return AGENTS.find(a => a.id === id); }
function formatK(v) { return v >= 1000 ? Math.round(v/1000)+'K‚Ç¨' : v+'‚Ç¨'; }
function getStageColor(stage) {
  const map = {
    'N√©gociation':{ bg:'rgba(16,185,129,0.12)', text:'#10b981' },
    'Proposition':{ bg:'rgba(245,158,11,0.12)', text:'#f59e0b' },
    'Qualification':{ bg:'rgba(139,92,246,0.12)', text:'#8b5cf6' },
    'Closing':{ bg:'rgba(244,63,94,0.12)', text:'#f43f5e' },
    'D√©couverte':{ bg:'rgba(59,130,246,0.12)', text:'#3b82f6' },
    'Simulation':{ bg:'rgba(245,158,11,0.12)', text:'#f59e0b' },
    'Contact':{ bg:'rgba(59,130,246,0.12)', text:'#3b82f6' },
    'Onboarding':{ bg:'rgba(139,92,246,0.12)', text:'#8b5cf6' },
    'Sign√©':{ bg:'rgba(16,185,129,0.12)', text:'#10b981' }
  };
  return map[stage] || { bg:'rgba(92,93,112,0.12)', text:'#5c5d70' };
}
function getStatusInfo(s) {
  const map = {
    'active':{ bg:'rgba(16,185,129,0.12)', text:'#10b981', label:'Active' },
    'draft':{ bg:'rgba(92,93,112,0.12)', text:'#5c5d70', label:'Brouillon' },
    'completed':{ bg:'rgba(59,130,246,0.12)', text:'#3b82f6', label:'Termin√©e' },
    'paused':{ bg:'rgba(245,158,11,0.12)', text:'#f59e0b', label:'Pause' },
    'en_cours':{ bg:'rgba(59,130,246,0.12)', text:'#3b82f6', label:'En cours' },
    'planifiee':{ bg:'rgba(139,92,246,0.12)', text:'#8b5cf6', label:'Planifi√©e' },
    'terminee':{ bg:'rgba(16,185,129,0.12)', text:'#10b981', label:'Termin√©e' },
    'new':{ bg:'rgba(59,130,246,0.12)', text:'#3b82f6', label:'Nouveau' },
    'contacted':{ bg:'rgba(245,158,11,0.12)', text:'#f59e0b', label:'Contact√©' },
    'interested':{ bg:'rgba(139,92,246,0.12)', text:'#8b5cf6', label:'Int√©ress√©' },
    'meeting':{ bg:'rgba(6,182,212,0.12)', text:'#06b6d4', label:'RDV planifi√©' },
    'converted':{ bg:'rgba(16,185,129,0.12)', text:'#10b981', label:'Converti' }
  };
  return map[s] || { bg:'rgba(92,93,112,0.12)', text:'#5c5d70', label:s };
}
function showToast(html) {
  const t = document.getElementById('toast');
  document.getElementById('toast-text').innerHTML = html;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 4000);
}

// ===== NAVIGATION =====
// ===== THEME TOGGLE =====
function toggleTheme() {
  const html = document.documentElement;
  const current = html.getAttribute('data-theme');
  const next = current === 'light' ? 'dark' : 'light';
  html.setAttribute('data-theme', next);
  document.getElementById('theme-icon').textContent = next === 'light' ? 'dark_mode' : 'light_mode';
  document.getElementById('theme-label').textContent = next === 'light' ? 'Mode Sombre' : 'Mode Clair';
  localStorage.setItem('portage-ai-theme', next);
  // Update chart colors if charts exist
  if(typeof Chart !== 'undefined') {
    Chart.helpers.each(Chart.instances, (chart) => {
      if(chart.options.scales) {
        const gridColor = next === 'light' ? 'rgba(0,0,0,0.06)' : 'rgba(255,255,255,0.04)';
        const tickColor = next === 'light' ? '#5c5d70' : '#5c5d70';
        Object.values(chart.options.scales).forEach(scale => {
          if(scale.grid) scale.grid.color = gridColor;
          if(scale.ticks) scale.ticks.color = tickColor;
        });
      }
      chart.update('none');
    });
  }
}
// Restore saved theme on load
(function() {
  const saved = localStorage.getItem('portage-ai-theme');
  if(saved === 'light') {
    document.documentElement.setAttribute('data-theme', 'light');
    setTimeout(() => {
      document.getElementById('theme-icon').textContent = 'dark_mode';
      document.getElementById('theme-label').textContent = 'Mode Sombre';
    }, 0);
  }
})();

function navigate(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-'+page).classList.add('active');
  document.querySelector(`.nav-item[data-page="${page}"]`).classList.add('active');
  if(page === 'dashboard') initDashboardCharts();
}
function toggleSidebar() {
  const sb = document.getElementById('sidebar');
  sb.classList.toggle('collapsed');
  document.getElementById('toggle-icon').textContent = sb.classList.contains('collapsed') ? 'chevron_right' : 'chevron_left';
}

// ===== RENDER FUNNEL =====
function renderFunnel(data, containerId) {
  const maxCount = data[0].count;
  let html = '';
  data.forEach(step => {
    const pct = (step.count / maxCount * 100);
    html += `<div class="funnel-step">
      <div class="funnel-label">${step.label}</div>
      <div class="funnel-bar-bg"><div class="funnel-bar" style="width:${pct}%;background:${step.color}"><span>${step.count.toLocaleString('fr')}</span></div></div>
      <div class="funnel-rate">${step.rate}</div>
    </div>`;
  });
  document.getElementById(containerId).innerHTML = html;
}

// ===== RENDER PIPELINE =====
function renderPipeline(data, containerId) {
  let html = `<div class="pipeline-row header"><div>Entreprise</div><div>√âtape</div><div>Valeur</div><div>Agent</div><div>Secteur</div></div>`;
  data.forEach(item => {
    const sc = getStageColor(item.stage);
    const ag = getAgent(item.agent);
    html += `<div class="pipeline-row">
      <div><div class="pipeline-name">${item.name}</div></div>
      <div><span class="stage-badge" style="background:${sc.bg};color:${sc.text}">${item.stage}</span></div>
      <div class="pipeline-value">${formatK(item.value)}</div>
      <div><span class="pipeline-agent" style="background:${ag.bg};color:${ag.color}">${ag.emoji} ${ag.name}</span></div>
      <div style="font-size:12px;color:var(--text-muted)">${item.sector}</div>
    </div>`;
  });
  document.getElementById(containerId).innerHTML = html;
}

// ===== SIMULATEUR =====
function calculateSimulation() {
  const tjm = parseFloat(document.getElementById('sim-tjm').value) || 0;
  const jours = parseFloat(document.getElementById('sim-jours').value) || 0;
  const fraisPro = parseFloat(document.getElementById('sim-frais').value) || 0;
  const tauxGestion = 0.05; // 5% frais de gestion

  const caHT = tjm * jours;
  const fraisGestion = caHT * tauxGestion;
  const caNet = caHT - fraisGestion - fraisPro;
  const chargesPatronales = caNet * 0.42;
  const salaireBrut = caNet - chargesPatronales;
  const chargesSalariales = salaireBrut * 0.22;
  const salaireNet = salaireBrut - chargesSalariales;
  const salaireNetImpot = salaireNet * 0.9; // approx PAS 10%

  document.getElementById('sim-results').style.display = 'block';
  document.getElementById('sim-net').textContent = Math.round(salaireNet).toLocaleString('fr') + ' ‚Ç¨';
  document.getElementById('sim-bd-ca').textContent = Math.round(caHT).toLocaleString('fr') + ' ‚Ç¨';
  document.getElementById('sim-bd-gestion').textContent = Math.round(fraisGestion).toLocaleString('fr') + ' ‚Ç¨';
  document.getElementById('sim-bd-charges-p').textContent = Math.round(chargesPatronales).toLocaleString('fr') + ' ‚Ç¨';
  document.getElementById('sim-bd-brut').textContent = Math.round(salaireBrut).toLocaleString('fr') + ' ‚Ç¨';
  document.getElementById('sim-bd-charges-s').textContent = Math.round(chargesSalariales).toLocaleString('fr') + ' ‚Ç¨';
  document.getElementById('sim-bd-net-impot').textContent = Math.round(salaireNetImpot).toLocaleString('fr') + ' ‚Ç¨';
  document.getElementById('sim-bd-frais').textContent = Math.round(fraisPro).toLocaleString('fr') + ' ‚Ç¨';
}

function calculateInverse() {
  const salaireSouhaite = parseFloat(document.getElementById('sim-inv-salaire').value) || 0;
  const jours = parseFloat(document.getElementById('sim-inv-jours').value) || 0;
  if(!salaireSouhaite || !jours) return;

  const salaireNet = salaireSouhaite;
  const salaireBrut = salaireNet / 0.78;
  const caNet = salaireBrut / 0.58;
  const fraisGestion = caNet * 0.05 / 0.95;
  const caHT = caNet + fraisGestion;
  const tjm = Math.round(caHT / jours);

  document.getElementById('sim-inv-results').style.display = 'block';
  document.getElementById('sim-inv-tjm-result').textContent = tjm.toLocaleString('fr') + ' ‚Ç¨/jour';
  document.getElementById('sim-inv-ca').textContent = Math.round(caHT).toLocaleString('fr') + ' ‚Ç¨';
  document.getElementById('sim-inv-gestion').textContent = Math.round(fraisGestion).toLocaleString('fr') + ' ‚Ç¨';
  document.getElementById('sim-inv-brut').textContent = Math.round(salaireBrut).toLocaleString('fr') + ' ‚Ç¨';
}

// ===== CRM: Create prospect from simulation =====
function submitSimulationWithCRM() {
  const nom = document.getElementById('sim-nom').value.trim();
  const prenom = document.getElementById('sim-prenom').value.trim();
  const email = document.getElementById('sim-email').value.trim();
  const tel = document.getElementById('sim-tel').value.trim();
  const tjm = parseFloat(document.getElementById('sim-tjm').value) || 0;
  const jours = parseFloat(document.getElementById('sim-jours').value) || 0;

  if(!nom || !email || !tel) {
    showToast('<strong>Erreur</strong> ‚Äî Veuillez remplir nom, email et t√©l√©phone');
    document.getElementById('toast').querySelector('.toast-icon').textContent = 'error';
    document.getElementById('toast').querySelector('.toast-icon').style.color = 'var(--accent-red)';
    setTimeout(() => {
      document.getElementById('toast').querySelector('.toast-icon').textContent = 'check_circle';
      document.getElementById('toast').querySelector('.toast-icon').style.color = 'var(--accent-green)';
    }, 4100);
    return;
  }

  // Calculate
  calculateSimulation();

  // Create CRM prospect
  simCounter++;
  const agents = ['luna','alex','aria'];
  const assignedAgent = agents[simCounter % agents.length];
  const ag = getAgent(assignedAgent);
  const caHT = tjm * jours;
  const salaireNet = Math.round(caHT * 0.95 * 0.58 * 0.78);

  const prospect = {
    id: simCounter,
    nom, prenom, email, tel,
    tjm, jours,
    caHT,
    salaireNet,
    agent: assignedAgent,
    date: new Date().toLocaleDateString('fr-FR'),
    heure: new Date().toLocaleTimeString('fr-FR', {hour:'2-digit',minute:'2-digit'}),
    status: 'simulation',
    score: Math.min(99, Math.round(50 + tjm/20 + jours*2)),
    simulations: [{ date: new Date().toLocaleDateString('fr-FR'), tjm, jours, salaireNet }]
  };

  CRM_PROSPECTS.unshift(prospect);
  updateCRMBadge();
  renderCRM();

  // Add to B2C pipeline
  B2C_PIPELINE.unshift({ name: prenom+' '+nom, sector: 'Simulation', stage:'Simulation', value: tjm, agent: assignedAgent });

  showToast(`<strong>Fiche CRM cr√©√©e</strong> ‚Äî ${prenom} ${nom} assign√© √† ${ag.emoji} ${ag.name}`);
}

function updateCRMBadge() {
  document.getElementById('crm-badge').textContent = CRM_PROSPECTS.length;
}

// ===== RENDER PAGES =====
function buildAllPages() {
  const mc = document.getElementById('main-content');
  mc.innerHTML = '';

  // DASHBOARD
  mc.innerHTML += `
  <div class="page active" id="page-dashboard">
    <div class="page-header">
      <div><div class="page-title">Dashboard</div><div class="page-subtitle">Vue d'ensemble de l'activit√© commerciale</div></div>
      <div class="live-badge"><div class="live-dot"></div><span>Live</span></div>
    </div>
    <div class="kpi-grid">
      <div class="kpi-card">
        <div class="kpi-header"><div class="kpi-icon" style="background:rgba(59,130,246,0.12)"><span class="material-icons-round" style="color:#3b82f6">contacts</span></div><div class="kpi-trend up">‚Üó +18%</div></div>
        <div class="kpi-value">2 057</div><div class="kpi-label">Contacts G√©n√©r√©s</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-header"><div class="kpi-icon" style="background:rgba(16,185,129,0.12)"><span class="material-icons-round" style="color:#10b981">verified</span></div><div class="kpi-trend up">‚Üó +24%</div></div>
        <div class="kpi-value">666</div><div class="kpi-label">Leads Qualifi√©s</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-header"><div class="kpi-icon" style="background:rgba(245,158,11,0.12)"><span class="material-icons-round" style="color:#f59e0b">event_available</span></div><div class="kpi-trend up">‚Üó +12%</div></div>
        <div class="kpi-value">307</div><div class="kpi-label">RDV Obtenus</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-header"><div class="kpi-icon" style="background:rgba(139,92,246,0.12)"><span class="material-icons-round" style="color:#8b5cf6">trending_up</span></div><div class="kpi-trend up">‚Üó +3pts</div></div>
        <div class="kpi-value">58%</div><div class="kpi-label">Taux Conv. Moy.</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-header"><div class="kpi-icon" style="background:rgba(244,63,94,0.12)"><span class="material-icons-round" style="color:#f43f5e">account_balance</span></div><div class="kpi-trend up">‚Üó +31%</div></div>
        <div class="kpi-value">136K‚Ç¨</div><div class="kpi-label">Pipeline B2B</div>
      </div>
    </div>
    <div class="grid-2">
      <div class="panel"><div class="panel-header"><div class="panel-title">Performance Hebdomadaire</div><div class="panel-badge" style="background:rgba(59,130,246,0.12);color:#3b82f6">7 derniers jours</div></div><div class="chart-container"><canvas id="chart-weekly"></canvas></div></div>
      <div class="panel"><div class="panel-header"><div class="panel-title">Funnel de Conversion</div><div class="panel-badge" style="background:rgba(16,185,129,0.12);color:#10b981">‚óè Temps r√©el</div></div><div id="funnel-dashboard"></div></div>
    </div>
    <div class="grid-5-3">
      <div class="panel"><div class="panel-header"><div class="panel-title">Activit√© en Direct</div></div><div id="activity-feed"></div></div>
      <div class="panel"><div class="panel-header"><div class="panel-title">Classement Agents</div></div><div id="leaderboard"></div></div>
    </div>
  </div>`;

  // AGENTS
  let agentCards = '';
  AGENTS.forEach(a => {
    const statusInfo = a.status === 'active' ? {bg:'rgba(16,185,129,0.12)',text:'#10b981',label:'Actif'} : a.status === 'busy' ? {bg:'rgba(245,158,11,0.12)',text:'#f59e0b',label:'Occup√©'} : {bg:'rgba(92,93,112,0.12)',text:'#5c5d70',label:'Veille'};
    agentCards += `<div class="agent-card">
      <div class="agent-header">
        <div class="agent-avatar" style="background:${a.bg}"><img src="${a.photo}" alt="${a.name}"></div>
        <div><div class="agent-name">${a.name}</div><div class="agent-role">${a.role}</div></div>
        <div class="agent-status" style="background:${statusInfo.bg};color:${statusInfo.text}">${statusInfo.label}</div>
      </div>
      <div class="agent-metrics">
        <div class="agent-metric"><div class="agent-metric-val" style="color:${a.color}">${a.score}</div><div class="agent-metric-lbl">Score</div></div>
        <div class="agent-metric"><div class="agent-metric-val">${a.contacts}</div><div class="agent-metric-lbl">Contacts</div></div>
        <div class="agent-metric"><div class="agent-metric-val">${a.deals}</div><div class="agent-metric-lbl">Deals</div></div>
      </div>
      <div class="agent-specialties">${a.specialties.map(s => `<span class="agent-specialty">${s}</span>`).join('')}</div>
    </div>`;
  });
  mc.innerHTML += `<div class="page" id="page-agents">
    <div class="page-header"><div><div class="page-title">Agents IA</div><div class="page-subtitle">√âquipe commerciale automatis√©e ‚Äî 5 agents sp√©cialis√©s</div></div></div>
    <div class="agent-grid">${agentCards}</div>
  </div>`;

  // B2B
  mc.innerHTML += `<div class="page" id="page-b2b">
    <div class="page-header"><div><div class="page-title">Pipeline B2B</div><div class="page-subtitle">Entreprises et contrats-cadres</div></div></div>
    <div class="kpi-grid">
      <div class="kpi-card"><div class="kpi-value">${B2B_PIPELINE.length}</div><div class="kpi-label">Opportunit√©s</div></div>
      <div class="kpi-card"><div class="kpi-value">${formatK(B2B_PIPELINE.reduce((s,p)=>s+p.value,0))}</div><div class="kpi-label">Valeur Pipeline</div></div>
      <div class="kpi-card"><div class="kpi-value" style="color:#10b981">${B2B_FUNNEL[B2B_FUNNEL.length-1].rate}</div><div class="kpi-label">Taux Closing</div></div>
    </div>
    <div class="grid-5-3">
      <div class="panel"><div class="panel-header"><div class="panel-title">Opportunit√©s en cours</div></div><div id="b2b-pipeline"></div></div>
      <div class="panel"><div class="panel-header"><div class="panel-title">Funnel B2B</div></div><div id="funnel-b2b"></div></div>
    </div>
  </div>`;

  // B2C
  mc.innerHTML += `<div class="page" id="page-b2c">
    <div class="page-header"><div><div class="page-title">Pipeline B2C</div><div class="page-subtitle">Consultants ind√©pendants et freelances</div></div></div>
    <div class="kpi-grid">
      <div class="kpi-card"><div class="kpi-value">${B2C_PIPELINE.length}</div><div class="kpi-label">Prospects</div></div>
      <div class="kpi-card"><div class="kpi-value">${B2C_PIPELINE.filter(p=>p.stage==='Sign√©').length}</div><div class="kpi-label">Sign√©s</div></div>
      <div class="kpi-card"><div class="kpi-value" style="color:#10b981">${B2C_FUNNEL[B2C_FUNNEL.length-1].rate}</div><div class="kpi-label">Taux Conversion</div></div>
    </div>
    <div class="grid-5-3">
      <div class="panel"><div class="panel-header"><div class="panel-title">Prospects en cours</div></div><div id="b2c-pipeline"></div></div>
      <div class="panel"><div class="panel-header"><div class="panel-title">Funnel B2C</div></div><div id="funnel-b2c"></div></div>
    </div>
  </div>`;

  // CRM
  mc.innerHTML += `<div class="page" id="page-crm">
    <div class="page-header"><div><div class="page-title">CRM</div><div class="page-subtitle">Fiches prospects g√©n√©r√©es par le simulateur</div></div></div>
    <div class="search-box"><span class="material-icons-round">search</span><input placeholder="Rechercher un prospect (nom, email, t√©l√©phone)..." oninput="filterCRM(this.value)"></div>
    <div id="crm-list"><div style="text-align:center;padding:60px 20px;color:var(--text-muted)"><span class="material-icons-round" style="font-size:48px;display:block;margin-bottom:12px">contact_page</span>Aucun prospect pour le moment.<br>Utilisez le <strong>Simulateur</strong> pour g√©n√©rer automatiquement des fiches CRM.</div></div>
  </div>`;

  // SIMULATEUR
  mc.innerHTML += `<div class="page" id="page-simulateur">
    <div class="page-header"><div><div class="page-title">Simulateur de Revenus</div><div class="page-subtitle">Calculez votre salaire net en portage salarial ‚Äî Bar√®me Light Portage</div></div></div>
    <div class="grid-2">
      <div class="panel">
        <div class="panel-header"><div class="panel-title">üìä Simulation Standard (TJM ‚Üí Net)</div></div>
        <div class="form-row">
          <div class="form-group"><label class="form-label">Pr√©nom</label><input class="form-input" id="sim-prenom" placeholder="Jean"></div>
          <div class="form-group"><label class="form-label">Nom</label><input class="form-input" id="sim-nom" placeholder="Dupont"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label class="form-label">Email *</label><input class="form-input" id="sim-email" type="email" placeholder="jean@email.com"></div>
          <div class="form-group"><label class="form-label">T√©l√©phone *</label><input class="form-input" id="sim-tel" type="tel" placeholder="06 12 34 56 78"></div>
        </div>
        <hr style="border-color:var(--border);margin:16px 0">
        <div class="form-row">
          <div class="form-group"><label class="form-label">TJM (‚Ç¨/jour)</label><input class="form-input" id="sim-tjm" type="number" placeholder="550" value="550"></div>
          <div class="form-group"><label class="form-label">Jours travaill√©s / mois</label><input class="form-input" id="sim-jours" type="number" placeholder="18" value="18"></div>
        </div>
        <div class="form-group"><label class="form-label">Frais professionnels (‚Ç¨/mois)</label><input class="form-input" id="sim-frais" type="number" placeholder="0" value="0"></div>
        <button class="btn btn-primary" style="width:100%;justify-content:center;margin-top:8px" onclick="submitSimulationWithCRM()">
          <span class="material-icons-round" style="font-size:18px">calculate</span> Calculer et cr√©er fiche CRM
        </button>
        <div id="sim-results" style="display:none">
          <div class="sim-result-card">
            <div style="font-size:12px;color:var(--text-muted);margin-bottom:4px">Salaire Net Mensuel Estim√©</div>
            <div id="sim-net" class="sim-result-value">‚Äî</div>
          </div>
          <div class="sim-breakdown">
            <div class="sim-breakdown-item"><div class="sim-breakdown-val" style="color:#3b82f6" id="sim-bd-ca">‚Äî</div><div class="sim-breakdown-lbl">CA HT</div></div>
            <div class="sim-breakdown-item"><div class="sim-breakdown-val" style="color:#f59e0b" id="sim-bd-gestion">‚Äî</div><div class="sim-breakdown-lbl">Frais gestion (5%)</div></div>
            <div class="sim-breakdown-item"><div class="sim-breakdown-val" style="color:#f43f5e" id="sim-bd-charges-p">‚Äî</div><div class="sim-breakdown-lbl">Charges patron.</div></div>
            <div class="sim-breakdown-item"><div class="sim-breakdown-val" style="color:#8b5cf6" id="sim-bd-brut">‚Äî</div><div class="sim-breakdown-lbl">Salaire Brut</div></div>
            <div class="sim-breakdown-item"><div class="sim-breakdown-val" style="color:#f43f5e" id="sim-bd-charges-s">‚Äî</div><div class="sim-breakdown-lbl">Charges salar.</div></div>
            <div class="sim-breakdown-item"><div class="sim-breakdown-val" style="color:#10b981" id="sim-bd-net-impot">‚Äî</div><div class="sim-breakdown-lbl">Net apr√®s PAS</div></div>
            <div class="sim-breakdown-item"><div class="sim-breakdown-val" id="sim-bd-frais">‚Äî</div><div class="sim-breakdown-lbl">Frais pro.</div></div>
          </div>
        </div>
      </div>
      <div class="panel">
        <div class="panel-header"><div class="panel-title">üîÑ Simulation Invers√©e (Salaire ‚Üí TJM)</div></div>
        <div class="form-group"><label class="form-label">Salaire net souhait√© (‚Ç¨/mois)</label><input class="form-input" id="sim-inv-salaire" type="number" placeholder="3500" value="3500"></div>
        <div class="form-group"><label class="form-label">Jours travaill√©s / mois</label><input class="form-input" id="sim-inv-jours" type="number" placeholder="18" value="18"></div>
        <button class="btn btn-success" style="width:100%;justify-content:center;margin-top:8px" onclick="calculateInverse()">
          <span class="material-icons-round" style="font-size:18px">swap_vert</span> Calculer le TJM n√©cessaire
        </button>
        <div id="sim-inv-results" style="display:none">
          <div class="sim-result-card" style="background:linear-gradient(135deg,rgba(16,185,129,0.08),rgba(6,182,212,0.08));border-color:rgba(16,185,129,0.2)">
            <div style="font-size:12px;color:var(--text-muted);margin-bottom:4px">TJM N√©cessaire</div>
            <div id="sim-inv-tjm-result" class="sim-result-value" style="color:#10b981">‚Äî</div>
          </div>
          <div class="sim-breakdown">
            <div class="sim-breakdown-item"><div class="sim-breakdown-val" style="color:#3b82f6" id="sim-inv-ca">‚Äî</div><div class="sim-breakdown-lbl">CA HT requis</div></div>
            <div class="sim-breakdown-item"><div class="sim-breakdown-val" style="color:#f59e0b" id="sim-inv-gestion">‚Äî</div><div class="sim-breakdown-lbl">Frais gestion</div></div>
            <div class="sim-breakdown-item"><div class="sim-breakdown-val" style="color:#8b5cf6" id="sim-inv-brut">‚Äî</div><div class="sim-breakdown-lbl">Salaire Brut</div></div>
          </div>
        </div>
      </div>
    </div>
  </div>`;

  // CAMPAGNES
  let campCards = '';
  CAMPAIGNS.forEach(c => {
    const st = getStatusInfo(c.status);
    const openRate = c.sent > 0 ? Math.round(c.opened/c.sent*100) : 0;
    const clickRate = c.sent > 0 ? Math.round(c.clicked/c.sent*100) : 0;
    campCards += `<div class="campaign-card">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px">
        <div><div style="font-size:15px;font-weight:700">${c.name}</div><div style="font-size:12px;color:var(--text-muted);margin-top:2px">${c.agentEmoji} ${c.agent} ‚Ä¢ ${c.target}</div></div>
        <span class="stage-badge" style="background:${st.bg};color:${st.text}">${st.label}</span>
      </div>
      <div class="campaign-metrics">
        <div class="campaign-metric"><div class="campaign-metric-val">${c.sent.toLocaleString('fr')}</div><div class="campaign-metric-lbl">Envoy√©s</div></div>
        <div class="campaign-metric"><div class="campaign-metric-val" style="color:#10b981">${openRate}%</div><div class="campaign-metric-lbl">Ouverture</div></div>
        <div class="campaign-metric"><div class="campaign-metric-val" style="color:#f59e0b">${clickRate}%</div><div class="campaign-metric-lbl">Clic</div></div>
        <div class="campaign-metric"><div class="campaign-metric-val" style="color:#8b5cf6">${c.replies}</div><div class="campaign-metric-lbl">R√©ponses</div></div>
        <div class="campaign-metric"><div class="campaign-metric-val" style="color:#3b82f6">${c.meetings}</div><div class="campaign-metric-lbl">RDV</div></div>
      </div>
      ${c.sent > 0 ? `<div class="progress-bar"><div class="progress-fill" style="width:${openRate}%;background:#10b981"></div></div>` : ''}
      <div style="display:flex;justify-content:space-between;font-size:11px;color:var(--text-muted);margin-top:6px"><span>${c.type.toUpperCase()}</span></div>
    </div>`;
  });
  mc.innerHTML += `<div class="page" id="page-campagnes">
    <div class="page-header"><div><div class="page-title">Campagnes</div><div class="page-subtitle">Gestion des campagnes email et multicanal</div></div>
      <button class="btn btn-primary"><span class="material-icons-round" style="font-size:18px">add</span> Nouvelle Campagne</button>
    </div>
    <div class="grid-2">${campCards}</div>
  </div>`;

  // LINKEDIN
  let profileCards = '';
  LINKEDIN_PROFILES.forEach(p => {
    const st = getStatusInfo(p.status);
    const scoreColor = p.score >= 85 ? '#10b981' : p.score >= 70 ? '#f59e0b' : '#5c5d70';
    profileCards += `<div class="profile-card">
      <div class="profile-header">
        <div class="profile-avatar">${p.name.charAt(0)}</div>
        <div style="flex:1"><div style="font-size:15px;font-weight:700">${p.name}</div><div style="font-size:13px;color:var(--text-secondary)">${p.title}</div><div style="font-size:11px;color:var(--text-muted)">${p.company} ‚Ä¢ ${p.location}</div></div>
        <div style="text-align:center"><div class="profile-score" style="color:${scoreColor}">${p.score}</div><div style="font-size:10px;color:var(--text-muted)">Score</div></div>
      </div>
      <div class="profile-skills">${p.skills.map(s => `<span class="profile-skill">${s}</span>`).join('')}</div>
      <div style="display:flex;align-items:center;gap:12px;margin-top:10px">
        <span class="stage-badge" style="background:${st.bg};color:${st.text}">${st.label}</span>
        <span style="font-size:12px;font-weight:600;flex:1">TJM: ${p.tjm}‚Ç¨/j</span>
        <span style="font-size:11px;color:var(--text-muted);background:var(--bg-input);padding:4px 8px;border-radius:6px">${getAgent(p.agent.toLowerCase())?.emoji || ''} ${p.agent}</span>
      </div>
    </div>`;
  });
  mc.innerHTML += `<div class="page" id="page-linkedin">
    <div class="page-header"><div><div class="page-title">LinkedIn</div><div class="page-subtitle">Prospection et suivi des profils LinkedIn</div></div>
      <button class="btn btn-linkedin" onclick="openLinkedInSearch()"><span class="material-icons-round" style="font-size:18px">search</span> Lancer une recherche</button>
    </div>
    <div id="linkedin-search-panel" style="display:none;margin-bottom:20px;">
      <div class="panel" style="border:2px solid var(--accent-linkedin);">
        <div class="panel-header"><div class="panel-title" style="color:var(--accent-linkedin);">Recherche LinkedIn avanc√©e</div>
          <button class="btn" style="background:var(--bg-input);color:var(--text-secondary);font-size:12px;padding:6px 12px;" onclick="closeLinkedInSearch()">Fermer</button>
        </div>
        <div class="grid-2" style="gap:12px;margin-bottom:16px;">
          <div class="form-group"><label class="form-label">Poste / Titre</label><input class="form-input" id="li-search-title" placeholder="Ex: DevOps, Data Engineer, Chef de projet..."></div>
          <div class="form-group"><label class="form-label">Entreprise</label><input class="form-input" id="li-search-company" placeholder="Ex: Capgemini, Freelance..."></div>
          <div class="form-group"><label class="form-label">Localisation</label><input class="form-input" id="li-search-location" placeholder="Ex: Paris, Lyon, Nantes..."></div>
          <div class="form-group"><label class="form-label">Comp\u00e9tences</label><input class="form-input" id="li-search-skills" placeholder="Ex: Python, AWS, SAP..."></div>
          <div class="form-group"><label class="form-label">TJM minimum (\u20ac/j)</label><input class="form-input" type="number" id="li-search-tjm" placeholder="500"></div>
          <div class="form-group"><label class="form-label">Score minimum</label><input class="form-input" type="number" id="li-search-score" placeholder="70"></div>
        </div>
        <div style="display:flex;gap:10px;justify-content:flex-end;">
          <button class="btn" style="background:var(--bg-input);color:var(--text-secondary);" onclick="resetLinkedInSearch()"><span class="material-icons-round" style="font-size:16px">refresh</span> R\u00e9initialiser</button>
          <button class="btn btn-linkedin" onclick="executeLinkedInSearch()"><span class="material-icons-round" style="font-size:16px">search</span> Rechercher</button>
        </div>
      </div>
    </div>
    <div id="linkedin-search-results" style="display:none;margin-bottom:16px;"></div>
    <div class="search-box"><span class="material-icons-round">search</span><input placeholder="Filtrer les profils affich\u00e9s..." oninput="filterLinkedInProfiles(this.value)"></div>
    <div class="grid-2" id="linkedin-profiles-grid">${profileCards}</div>
  </div>`;

  // MISSIONS
  let missionCards = '';
  MISSIONS.forEach(m => {
    const ag = getAgent(m.agent);
    const pr = m.priority === 'haute' ? {bg:'rgba(244,63,94,0.12)',text:'#f43f5e'} : m.priority === 'moyenne' ? {bg:'rgba(245,158,11,0.12)',text:'#f59e0b'} : {bg:'rgba(92,93,112,0.12)',text:'#5c5d70'};
    const st = getStatusInfo(m.status);
    missionCards += `<div class="mission-card" style="border-left-color:${ag.color}">
      <div style="display:flex;justify-content:space-between;margin-bottom:10px">
        <div style="flex:1;margin-right:12px"><div style="font-size:15px;font-weight:700">${m.title}</div><div style="font-size:12px;color:var(--text-secondary);margin-top:4px;line-height:1.5">${m.desc}</div></div>
        <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end">
          <span class="stage-badge" style="background:${pr.bg};color:${pr.text}">${m.priority}</span>
          <span class="stage-badge" style="background:${st.bg};color:${st.text}">${st.label}</span>
        </div>
      </div>
      <div class="mission-progress">
        <div class="mission-progress-header"><span class="mission-progress-label">${m.target}</span><span class="mission-progress-pct" style="color:${ag.color}">${m.progress}%</span></div>
        <div class="progress-bar"><div class="progress-fill" style="width:${m.progress}%;background:${ag.color}"></div></div>
      </div>
      <div style="display:flex;gap:16px;margin:10px 0">${m.metrics.map(mt => `<div style="text-align:center"><div style="font-size:15px;font-weight:700">${mt.v}</div><div style="font-size:10px;color:var(--text-muted)">${mt.l}</div></div>`).join('')}</div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
        <span style="font-size:12px;color:var(--text-secondary);background:var(--bg-input);padding:5px 10px;border-radius:8px">${ag.emoji} ${ag.name}</span>
        <span style="font-size:11px;color:var(--text-muted)"><span class="material-icons-round" style="font-size:14px;vertical-align:middle">event</span> ${m.deadline}</span>
      </div>
    </div>`;
  });
  mc.innerHTML += `<div class="page" id="page-missions">
    <div class="page-header"><div><div class="page-title">Missions</div><div class="page-subtitle">Suivi et gestion des missions commerciales</div></div>
      <button class="btn btn-primary" onclick="openMissionModal()"><span class="material-icons-round" style="font-size:18px">add</span> Nouvelle Mission</button>
    </div>
    <div class="kpi-grid">
      <div class="kpi-card" style="border-left:3px solid #3b82f6"><div class="kpi-value">${MISSIONS.filter(m=>m.status==='en_cours').length}</div><div class="kpi-label">En cours</div></div>
      <div class="kpi-card" style="border-left:3px solid #8b5cf6"><div class="kpi-value">${MISSIONS.filter(m=>m.status==='planifiee').length}</div><div class="kpi-label">Planifi√©es</div></div>
      <div class="kpi-card" style="border-left:3px solid #10b981"><div class="kpi-value">${MISSIONS.filter(m=>m.status==='terminee').length}</div><div class="kpi-label">Termin√©es</div></div>
      <div class="kpi-card" style="border-left:3px solid #f59e0b"><div class="kpi-value">${Math.round(MISSIONS.reduce((s,m)=>s+m.progress,0)/MISSIONS.length)}%</div><div class="kpi-label">Progression moy.</div></div>
    </div>
    <div class="grid-2">${missionCards}</div>
  </div>`;

  // CONFIG
  let agentToggles = '';
  AGENTS.forEach(a => {
    agentToggles += `<div class="config-row">
      <div class="agent-avatar" style="background:${a.bg};width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;overflow:hidden;border:2px solid rgba(255,255,255,0.8)"><img src="${a.photo}" alt="${a.name}" style="width:100%;height:100%;object-fit:cover"></div>
      <div style="flex:1"><div style="font-size:13px;font-weight:600">${a.name}</div><div style="font-size:11px;color:var(--text-muted)">${a.role}</div></div>
      <div class="switch ${a.status !== 'idle' ? 'on' : ''}" onclick="this.classList.toggle('on')"></div>
    </div>`;
  });
  // STRATEGIE - build HTML with helper function
  function buildStrategieStates() {
    return ['DISCOVERED|D\u00e9couvert|#3b82f6|Le profil est identifi\u00e9 sur LinkedIn','ENRICHED|Enrichi|#8b5cf6|Donn\u00e9es compl\u00e8tes scrap\u00e9es via API Voyager','QUALIFIED|Qualifi\u00e9|#f59e0b|Valid\u00e9 par le mod\u00e8le ML (GPC + BALD)','PENDING|En attente|#06b6d4|Demande de connexion envoy\u00e9e','CONNECTED|Connect\u00e9|#10b981|Connexion accept\u00e9e, pr\u00eat pour follow-up','COMPLETED|Termin\u00e9|#10b981|Message de suivi envoy\u00e9 avec succ\u00e8s','DISQUALIFIED|Disqualifi\u00e9|#f43f5e|Rejet\u00e9 par le pipeline de qualification'].map(s => {
      const [code,label,color,desc] = s.split('|');
      return '<div style="display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid var(--border)"><span class="stage-badge" style="background:'+color+'20;color:'+color+';min-width:100px;text-align:center;font-size:11px">'+label+'</span><div style="font-size:12px;color:var(--text-muted)">'+desc+'</div></div>';
    }).join('');
  }
  function buildStrategieTable() {
    return [
      {name:'OpenOutreach',cat:'Scraping LinkedIn',stars:'100+',stack:'Python, Playwright, Django',pts:'Campagnes compl\u00e8tes, ML, CRM int\u00e9gr\u00e9, stealth',rec:true},
      {name:'linkedin_scraper',cat:'Scraping LinkedIn',stars:'3 700',stack:'Python, Selenium',pts:'Extraction brute rapide de profils',rec:false},
      {name:'Fire-Enrich',cat:'Enrichissement IA',stars:'1 100',stack:'Python, Firecrawl, LLM',pts:'Multi-agents IA, profils entreprise complets',rec:true},
      {name:'theHarvester',cat:'OSINT / Emails',stars:'12 000',stack:'Python',pts:'20+ sources, emails et domaines',rec:false},
      {name:'Google Maps Scraper',cat:'Scraping Local',stars:'3 200',stack:'Go',pts:'Prospection commerces et services locaux',rec:false},
      {name:'Twenty',cat:'CRM Open Source',stars:'40 000',stack:'TypeScript, React, GraphQL',pts:'Alternative Salesforce, API puissante, extensible',rec:true},
      {name:'n8n',cat:'Orchestration',stars:'176 000',stack:'TypeScript, Node.js',pts:'400+ int\u00e9grations, \u00e9diteur visuel, IA native',rec:true},
      {name:'Activepieces',cat:'Orchestration',stars:'21 000',stack:'TypeScript',pts:'Approche moderne, orient\u00e9 IA et agents',rec:false}
    ].map(t => '<tr style="border-bottom:1px solid var(--border)"><td style="padding:12px;font-weight:600;color:var(--text-primary)">'+t.name+'</td><td style="padding:12px;color:var(--text-secondary)">'+t.cat+'</td><td style="padding:12px;text-align:center;font-weight:700;color:var(--accent-yellow)">'+t.stars+'</td><td style="padding:12px;color:var(--text-muted);font-size:11px">'+t.stack+'</td><td style="padding:12px;color:var(--text-secondary);font-size:12px">'+t.pts+'</td><td style="padding:12px;text-align:center">'+(t.rec ? '<span class="material-icons-round" style="color:#10b981;font-size:20px">check_circle</span>' : '<span style="color:var(--text-muted);font-size:12px">Alternatif</span>')+'</td></tr>').join('');
  }
  function buildOpenOutreachDetails() {
    return ['Connect|120s|Envoi de connexions ML-rank\u00e9es','Check Pending|24h|V\u00e9rification des acceptations','Follow Up|120s|Messages de suivi personnalis\u00e9s','Enrich|gap-filler|Scraping profils d\u00e9couverts','Qualify|gap-filler|Qualification ML des profils','Search|lowest|Recherche LLM de nouveaux profils'].map(l => {
      const [name,interval,desc] = l.split('|');
      return '<div style="background:var(--bg-input);border-radius:8px;padding:10px 12px"><div style="font-size:12px;font-weight:700;color:var(--text-primary)">'+name+'</div><div style="font-size:10px;color:var(--accent-blue)">Intervalle: '+interval+'</div><div style="font-size:11px;color:var(--text-muted)">'+desc+'</div></div>';
    }).join('');
  }
  function buildTwentyDetails() {
    return ['Vues Kanban / Table|Personnalisables par l\'utilisateur','Objets & champs custom|Mod\u00e8le de donn\u00e9es flexible','API GraphQL & REST|Int\u00e9gration programmatique compl\u00e8te','Extension Chrome|Capture de leads depuis le navigateur','N\u0153ud n8n|Connecteur communautaire disponible','MCP Server|Int\u00e9gration avec assistants IA'].map(f => {
      const [title,desc] = f.split('|');
      return '<div style="background:var(--bg-input);border-radius:8px;padding:10px 12px"><div style="font-size:12px;font-weight:700;color:var(--text-primary)">'+title+'</div><div style="font-size:11px;color:var(--text-muted)">'+desc+'</div></div>';
    }).join('');
  }
  function buildGithubLinks() {
    return [
      {name:'OpenOutreach',url:'https://github.com/eracle/OpenOutreach',icon:'person_search',color:'#0077b5'},
      {name:'Fire-Enrich',url:'https://github.com/firecrawl/fire-enrich',icon:'auto_fix_high',color:'#f59e0b'},
      {name:'Twenty CRM',url:'https://github.com/twentyhq/twenty',icon:'hub',color:'#3b82f6'},
      {name:'n8n',url:'https://github.com/n8n-io/n8n',icon:'account_tree',color:'#8b5cf6'}
    ].map(l => '<a href="'+l.url+'" target="_blank" style="text-decoration:none;display:block;background:var(--bg-input);border-radius:12px;padding:16px;text-align:center;border:1px solid var(--border);transition:all 0.2s;cursor:pointer" onmouseover="this.style.borderColor=\''+l.color+'\';this.style.transform=\'translateY(-2px)\'" onmouseout="this.style.borderColor=\'var(--border)\';this.style.transform=\'none\'"><span class="material-icons-round" style="font-size:28px;color:'+l.color+';display:block;margin-bottom:8px">'+l.icon+'</span><div style="font-size:13px;font-weight:700;color:var(--text-primary)">'+l.name+'</div><div style="font-size:10px;color:var(--text-muted);margin-top:4px">Voir sur GitHub \u2192</div></a>').join('');
  }
  mc.innerHTML += `<div class="page" id="page-strategie">
    <div class="page-header"><div><div class="page-title">Architecture de Prospection</div><div class="page-subtitle">Strat\u00e9gie d'outillage open source pour la force commerciale Portage AI</div></div></div>

    <div style="background:linear-gradient(135deg,rgba(16,185,129,0.08),rgba(59,130,246,0.08));border:2px solid var(--accent-green);border-radius:16px;padding:28px 32px;margin-bottom:28px">
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px"><span class="material-icons-round" style="font-size:28px;color:var(--accent-green)">tips_and_updates</span><div style="font-size:20px;font-weight:800;color:var(--accent-green)">Recommandation Strat\u00e9gique</div></div>
      <p style="font-size:14px;line-height:1.8;color:var(--text-secondary);margin-bottom:16px">Pour l'\u00e9cosyst\u00e8me <strong style='color:var(--text-primary)'>Portage AI</strong>, nous recommandons une architecture modulaire combinant 4 briques open source compl\u00e9mentaires, orchestr\u00e9es pour cr\u00e9er un pipeline de prospection automatis\u00e9 de bout en bout.</p>
      <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px">
        <div style="background:var(--bg-card);border-radius:12px;padding:16px;text-align:center;border:1px solid var(--border)">
          <span class="material-icons-round" style="font-size:32px;color:#0077b5;display:block;margin-bottom:8px">person_search</span>
          <div style="font-size:13px;font-weight:700;color:var(--text-primary)">OpenOutreach</div>
          <div style="font-size:11px;color:var(--text-muted);margin-top:4px">Scraping LinkedIn</div>
        </div>
        <div style="background:var(--bg-card);border-radius:12px;padding:16px;text-align:center;border:1px solid var(--border)">
          <span class="material-icons-round" style="font-size:32px;color:#f59e0b;display:block;margin-bottom:8px">auto_fix_high</span>
          <div style="font-size:13px;font-weight:700;color:var(--text-primary)">Fire-Enrich</div>
          <div style="font-size:11px;color:var(--text-muted);margin-top:4px">Enrichissement IA</div>
        </div>
        <div style="background:var(--bg-card);border-radius:12px;padding:16px;text-align:center;border:1px solid var(--border)">
          <span class="material-icons-round" style="font-size:32px;color:#3b82f6;display:block;margin-bottom:8px">hub</span>
          <div style="font-size:13px;font-weight:700;color:var(--text-primary)">Twenty CRM</div>
          <div style="font-size:11px;color:var(--text-muted);margin-top:4px">CRM Central</div>
        </div>
        <div style="background:var(--bg-card);border-radius:12px;padding:16px;text-align:center;border:1px solid var(--border)">
          <span class="material-icons-round" style="font-size:32px;color:#8b5cf6;display:block;margin-bottom:8px">account_tree</span>
          <div style="font-size:13px;font-weight:700;color:var(--text-primary)">n8n</div>
          <div style="font-size:11px;color:var(--text-muted);margin-top:4px">Orchestration</div>
        </div>
      </div>
    </div>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:28px">
      <div class="panel">
        <div class="panel-header"><div class="panel-title">Pipeline de Prospection</div><div class="panel-badge" style="background:rgba(59,130,246,0.12);color:#3b82f6">Flux automatis\u00e9</div></div>
        <div style="padding:4px 0">
          <div style="display:flex;align-items:center;gap:12px;padding:12px 0;border-bottom:1px solid var(--border)">
            <div style="width:32px;height:32px;border-radius:8px;background:rgba(0,119,181,0.12);display:flex;align-items:center;justify-content:center"><span class="material-icons-round" style="font-size:18px;color:#0077b5">person_search</span></div>
            <div style="flex:1"><div style="font-size:13px;font-weight:700;color:var(--text-primary)">1. D\u00e9couverte</div><div style="font-size:11px;color:var(--text-muted)">OpenOutreach scrape les profils LinkedIn via l'API Voyager</div></div>
          </div>
          <div style="display:flex;align-items:center;gap:12px;padding:12px 0;border-bottom:1px solid var(--border)">
            <div style="width:32px;height:32px;border-radius:8px;background:rgba(139,92,246,0.12);display:flex;align-items:center;justify-content:center"><span class="material-icons-round" style="font-size:18px;color:#8b5cf6">psychology</span></div>
            <div style="flex:1"><div style="font-size:13px;font-weight:700;color:var(--text-primary)">2. Qualification ML</div><div style="font-size:11px;color:var(--text-muted)">Gaussian Process Classifier + BALD active learning</div></div>
          </div>
          <div style="display:flex;align-items:center;gap:12px;padding:12px 0;border-bottom:1px solid var(--border)">
            <div style="width:32px;height:32px;border-radius:8px;background:rgba(245,158,11,0.12);display:flex;align-items:center;justify-content:center"><span class="material-icons-round" style="font-size:18px;color:#f59e0b">auto_fix_high</span></div>
            <div style="flex:1"><div style="font-size:13px;font-weight:700;color:var(--text-primary)">3. Enrichissement</div><div style="font-size:11px;color:var(--text-muted)">Fire-Enrich transforme les emails en datasets riches (entreprise, funding, tech)</div></div>
          </div>
          <div style="display:flex;align-items:center;gap:12px;padding:12px 0;border-bottom:1px solid var(--border)">
            <div style="width:32px;height:32px;border-radius:8px;background:rgba(59,130,246,0.12);display:flex;align-items:center;justify-content:center"><span class="material-icons-round" style="font-size:18px;color:#3b82f6">hub</span></div>
            <div style="flex:1"><div style="font-size:13px;font-weight:700;color:var(--text-primary)">4. Injection CRM</div><div style="font-size:11px;color:var(--text-muted)">Twenty CRM centralise les leads qualifi\u00e9s avec API GraphQL</div></div>
          </div>
          <div style="display:flex;align-items:center;gap:12px;padding:12px 0">
            <div style="width:32px;height:32px;border-radius:8px;background:rgba(16,185,129,0.12);display:flex;align-items:center;justify-content:center"><span class="material-icons-round" style="font-size:18px;color:#10b981">send</span></div>
            <div style="flex:1"><div style="font-size:13px;font-weight:700;color:var(--text-primary)">5. Outreach automatis\u00e9</div><div style="font-size:11px;color:var(--text-muted)">Messages personnalis\u00e9s Jinja2 + follow-up apr\u00e8s acceptation</div></div>
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header"><div class="panel-title">Machine d'\u00c9tat des Profils</div><div class="panel-badge" style="background:rgba(139,92,246,0.12);color:#8b5cf6">OpenOutreach</div></div>
        <div style="padding:4px 0">
          ${buildStrategieStates()}
        </div>
      </div>
    </div>

    <div class="panel" style="margin-bottom:28px">
      <div class="panel-header"><div class="panel-title">Comparatif des Outils</div><div class="panel-badge" style="background:rgba(16,185,129,0.12);color:#10b981">S\u00e9lection GitHub</div></div>
      <div style="overflow-x:auto">
        <table style="width:100%;border-collapse:collapse;font-size:13px">
          <thead><tr style="border-bottom:2px solid var(--border)">
            <th style="padding:12px;text-align:left;font-weight:700;color:var(--text-primary)">Outil</th>
            <th style="padding:12px;text-align:left;font-weight:700;color:var(--text-primary)">Cat\u00e9gorie</th>
            <th style="padding:12px;text-align:center;font-weight:700;color:var(--text-primary)">Stars</th>
            <th style="padding:12px;text-align:left;font-weight:700;color:var(--text-primary)">Stack</th>
            <th style="padding:12px;text-align:left;font-weight:700;color:var(--text-primary)">Points forts</th>
            <th style="padding:12px;text-align:center;font-weight:700;color:var(--text-primary)">Recommand\u00e9</th>
          </tr></thead>
          <tbody>
            ${buildStrategieTable()}
          </tbody>
        </table>
      </div>
    </div>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:28px">
      <div class="panel">
        <div class="panel-header"><div class="panel-title">OpenOutreach \u2014 D\u00e9tails</div></div>
        <div style="font-size:13px;color:var(--text-secondary);line-height:1.8;padding:4px 0">
          <p style="margin-bottom:12px">Outil self-hosted d'automatisation LinkedIn B2B. Daemon central tournant 24/7 avec 5 lanes prioritaires :</p>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px">
            ${buildOpenOutreachDetails()}
          </div>
          <p><strong style="color:var(--text-primary)">Rate limiting :</strong> 20 connexions/jour, 100/semaine (configurable)</p>
          <p><strong style="color:var(--text-primary)">D\u00e9ploiement :</strong> Docker Compose, self-hosted</p>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header"><div class="panel-title">Twenty CRM \u2014 D\u00e9tails</div></div>
        <div style="font-size:13px;color:var(--text-secondary);line-height:1.8;padding:4px 0">
          <p style="margin-bottom:12px">Alternative open source \u00e0 Salesforce avec 40 000 stars GitHub. Fonctionnalit\u00e9s cl\u00e9s :</p>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px">
            ${buildTwentyDetails()}
          </div>
          <p><strong style="color:var(--text-primary)">D\u00e9ploiement :</strong> Self-hosted (Docker) ou Cloud (twenty.com)</p>
          <p><strong style="color:var(--text-primary)">Licence :</strong> AGPL-3.0</p>
        </div>
      </div>
    </div>

    <div class="panel" style="margin-bottom:28px">
      <div class="panel-header"><div class="panel-title">Liens GitHub</div></div>
      <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px">
        ${buildGithubLinks()}
      </div>
    </div>
  </div>`;

  // PAGE PRESENTATION
  mc.innerHTML += `<div class="page" id="page-presentation">
    <div class="page-header">
      <div>
        <div class="page-title">Pr\u00e9sentation Strat\u00e9gique</div>
        <div class="page-subtitle">Architecture de Prospection Open Source ‚Äî 12 slides</div>
      </div>
      <div style="display:flex;gap:10px;align-items:center">
        <div style="display:flex;align-items:center;gap:6px;background:rgba(139,92,246,0.1);padding:6px 14px;border-radius:20px">
          <span class="material-icons-round" style="font-size:16px;color:#8b5cf6">slideshow</span>
          <span style="font-size:12px;font-weight:600;color:#8b5cf6">12 slides</span>
        </div>
      </div>
    </div>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:24px">
      <div style="background:var(--bg-card);border:1px solid var(--border);border-radius:14px;padding:18px">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
          <span class="material-icons-round" style="color:#0077b5;font-size:20px">work</span>
          <span style="font-weight:700;font-size:14px">OpenOutreach</span>
        </div>
        <div style="font-size:12px;color:var(--text-muted)">Scraping LinkedIn intelligent avec ML et anti-d\u00e9tection</div>
      </div>
      <div style="background:var(--bg-card);border:1px solid var(--border);border-radius:14px;padding:18px">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
          <span class="material-icons-round" style="color:#f59e0b;font-size:20px">local_fire_department</span>
          <span style="font-weight:700;font-size:14px">Fire-Enrich</span>
        </div>
        <div style="font-size:12px;color:var(--text-muted)">Enrichissement IA multi-agents (4 agents sp\u00e9cialis\u00e9s)</div>
      </div>
      <div style="background:var(--bg-card);border:1px solid var(--border);border-radius:14px;padding:18px">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
          <span class="material-icons-round" style="color:#3b82f6;font-size:20px">view_kanban</span>
          <span style="font-weight:700;font-size:14px">Twenty CRM + n8n</span>
        </div>
        <div style="font-size:12px;color:var(--text-muted)">CRM open source (40K stars) + orchestration (176K stars)</div>
      </div>
    </div>
    <div style="background:var(--bg-card);border:1px solid var(--border);border-radius:16px;padding:24px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
        <div style="font-size:16px;font-weight:700">Slides de la pr\u00e9sentation</div>
        <div style="display:flex;gap:8px">
          <button class="btn" style="background:rgba(59,130,246,0.1);color:#3b82f6;font-size:12px;padding:6px 14px;border-radius:8px;border:1px solid rgba(59,130,246,0.2);cursor:pointer" onclick="document.getElementById('pres-frame').requestFullscreen()">
            <span class="material-icons-round" style="font-size:14px;vertical-align:middle;margin-right:4px">fullscreen</span>Plein \u00e9cran
          </button>
        </div>
      </div>
      <div style="border-radius:12px;overflow:hidden;border:1px solid var(--border);aspect-ratio:16/9;background:#0F1115">
        <iframe id="pres-frame" src="presentation_strategie/slide_1_titre.html" style="width:100%;height:100%;border:none;transform-origin:0 0" onload="this.contentDocument.body.style.overflow='hidden'"></iframe>
      </div>
      <div style="display:flex;justify-content:center;align-items:center;gap:16px;margin-top:16px">
        <button class="btn" style="background:var(--bg-input);color:var(--text-secondary);padding:8px 16px;border-radius:8px;border:1px solid var(--border);cursor:pointer" onclick="changeSlide(-1)">
          <span class="material-icons-round" style="font-size:18px;vertical-align:middle">chevron_left</span> Pr\u00e9c\u00e9dent
        </button>
        <span id="slide-counter" style="font-size:14px;font-weight:700;color:var(--text-secondary)">1 / 12</span>
        <button class="btn" style="background:var(--bg-input);color:var(--text-secondary);padding:8px 16px;border-radius:8px;border:1px solid var(--border);cursor:pointer" onclick="changeSlide(1)">
          Suivant <span class="material-icons-round" style="font-size:18px;vertical-align:middle">chevron_right</span>
        </button>
      </div>
    </div>
  </div>`;

  mc.innerHTML += `<div class="page" id="page-config">
    <div class="page-header"><div><div class="page-title">Configuration</div><div class="page-subtitle">Param√®tres de la plateforme commerciale</div></div></div>
    <div class="grid-2">
      <div class="config-section">
        <div class="config-section-header"><span class="material-icons-round" style="color:#3b82f6">smart_toy</span><div class="config-section-title">Agents IA</div></div>
        <div class="config-section-desc">Activer ou d√©sactiver les agents commerciaux</div>
        ${agentToggles}
      </div>
      <div class="config-section">
        <div class="config-section-header"><span class="material-icons-round" style="color:#f59e0b">flag</span><div class="config-section-title">Objectifs Mensuels</div></div>
        <div class="config-section-desc">D√©finir les objectifs de performance</div>
        <div class="form-group"><label class="form-label">Objectif B2B (contrats/mois)</label><input class="form-input" value="50"></div>
        <div class="form-group"><label class="form-label">Objectif B2C (leads/mois)</label><input class="form-input" value="400"></div>
        <div class="form-group"><label class="form-label">Frais de gestion (%)</label><input class="form-input" value="5"></div>
      </div>
      <div class="config-section">
        <div class="config-section-header"><span class="material-icons-round" style="color:#8b5cf6">notifications</span><div class="config-section-title">Notifications</div></div>
        <div class="config-section-desc">Configurer les alertes et notifications</div>
        <div class="config-row"><div style="flex:1"><div style="font-size:13px;font-weight:600">Notifications email</div><div style="font-size:11px;color:var(--text-muted)">Recevoir les alertes par email</div></div><div class="switch on" onclick="this.classList.toggle('on')"></div></div>
        <div class="config-row"><div style="flex:1"><div style="font-size:13px;font-weight:600">Notifications Slack</div><div style="font-size:11px;color:var(--text-muted)">Int√©gration Slack</div></div><div class="switch" onclick="this.classList.toggle('on')"></div></div>
        <div class="config-row"><div style="flex:1"><div style="font-size:13px;font-weight:600">Attribution automatique</div><div style="font-size:11px;color:var(--text-muted)">Assigner les leads automatiquement</div></div><div class="switch on" onclick="this.classList.toggle('on')"></div></div>
      </div>
      <div class="config-section">
        <div class="config-section-header"><span class="material-icons-round" style="color:#10b981">extension</span><div class="config-section-title">Int√©grations</div></div>
        <div class="config-section-desc">Services connect√©s √† la plateforme</div>
        ${[
          {name:'LinkedIn Sales Navigator',icon:'work',status:'Connect√©',color:'#0077b5'},
          {name:'SendGrid Email',icon:'email',status:'Connect√©',color:'#10b981'},
          {name:'Slack Workspace',icon:'chat',status:'Non connect√©',color:'#5c5d70'},
          {name:'HubSpot CRM',icon:'hub',status:'Non connect√©',color:'#5c5d70'},
          {name:'Google Calendar',icon:'calendar_today',status:'Connect√©',color:'#4285f4'},
          {name:'Stripe Paiements',icon:'payment',status:'Connect√©',color:'#635bff'}
        ].map(i => `<div class="config-row">
          <span class="material-icons-round" style="color:${i.color}">${i.icon}</span>
          <div style="flex:1"><div style="font-size:13px;font-weight:600">${i.name}</div><div style="font-size:11px;color:${i.status==='Connect√©'?'#10b981':'var(--text-muted)'}">${i.status}</div></div>
          <button class="integration-btn" style="border-color:${i.status==='Connect√©'?'rgba(16,185,129,0.3)':'rgba(59,130,246,0.3)'};color:${i.status==='Connect√©'?'#10b981':'#3b82f6'}">${i.status==='Connect√©'?'G√©rer':'Connecter'}</button>
        </div>`).join('')}
      </div>
    </div>
  </div>`;
}

// ===== RENDER CRM =====
function renderCRM() {
  const container = document.getElementById('crm-list');
  if(!CRM_PROSPECTS.length) {
    container.innerHTML = `<div style="text-align:center;padding:60px 20px;color:var(--text-muted)"><span class="material-icons-round" style="font-size:48px;display:block;margin-bottom:12px">contact_page</span>Aucun prospect pour le moment.<br>Utilisez le <strong>Simulateur</strong> pour g√©n√©rer automatiquement des fiches CRM.</div>`;
    return;
  }
  let html = '';
  CRM_PROSPECTS.forEach(p => {
    const ag = getAgent(p.agent);
    const scoreColor = p.score >= 80 ? '#10b981' : p.score >= 60 ? '#f59e0b' : '#5c5d70';
    html += `<div class="crm-card">
      <div class="crm-header">
        <div class="crm-avatar" style="background:rgba(59,130,246,0.15);color:#3b82f6">${p.prenom.charAt(0)}${p.nom.charAt(0)}</div>
        <div style="flex:1"><div class="crm-name">${p.prenom} ${p.nom}</div><div class="crm-email">${p.email} ‚Ä¢ ${p.tel}</div></div>
        <div style="text-align:center"><div style="font-size:22px;font-weight:800;color:${scoreColor}">${p.score}</div><div style="font-size:10px;color:var(--text-muted)">Score</div></div>
      </div>
      <div class="crm-meta">
        <span class="crm-tag" style="background:rgba(59,130,246,0.12);color:#3b82f6">TJM: ${p.tjm}‚Ç¨/j</span>
        <span class="crm-tag" style="background:rgba(16,185,129,0.12);color:#10b981">Net: ${p.salaireNet.toLocaleString('fr')}‚Ç¨</span>
        <span class="crm-tag" style="background:${ag.bg};color:${ag.color}">${ag.emoji} ${ag.name}</span>
        <span class="crm-tag" style="background:rgba(139,92,246,0.12);color:#8b5cf6">Simulation</span>
        <span style="margin-left:auto;font-size:11px;color:var(--text-muted)">${p.date} √† ${p.heure}</span>
      </div>
      <div style="margin-top:10px;padding-top:10px;border-top:1px solid var(--border)">
        <div style="font-size:11px;font-weight:600;color:var(--text-secondary);margin-bottom:6px">Historique des simulations</div>
        ${p.simulations.map(s => `<div style="font-size:12px;color:var(--text-muted);padding:3px 0">${s.date} ‚Äî TJM: ${s.tjm}‚Ç¨/j, ${s.jours}j/mois ‚Üí Net: ${s.salaireNet.toLocaleString('fr')}‚Ç¨</div>`).join('')}
      </div>
    </div>`;
  });
  container.innerHTML = html;
}

function filterCRM(query) {
  const q = query.toLowerCase();
  const cards = document.querySelectorAll('#crm-list .crm-card');
  cards.forEach((card, i) => {
    const p = CRM_PROSPECTS[i];
    if(!p) return;
    const match = (p.nom+' '+p.prenom+' '+p.email+' '+p.tel).toLowerCase().includes(q);
    card.style.display = match ? '' : 'none';
  });
}

// ===== MISSIONS MODAL =====
function openMissionModal() { document.getElementById('mission-modal').classList.add('show'); }
function closeMissionModal() { document.getElementById('mission-modal').classList.remove('show'); }
function createMission() {
  const title = document.getElementById('mission-title').value;
  if(!title) return;
  closeMissionModal();
  showToast(`<strong>Mission cr√©√©e</strong> ‚Äî "${title}"`);
}

// ===== DASHBOARD CHARTS =====
let weeklyChart = null;
function initDashboardCharts() {
  // Weekly chart
  const ctx = document.getElementById('chart-weekly');
  if(!ctx) return;
  if(weeklyChart) weeklyChart.destroy();
  weeklyChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['Lun','Mar','Mer','Jeu','Ven','Sam','Dim'],
      datasets: AGENTS.filter(a => a.id !== 'max').map(a => ({
        label: a.name,
        data: a.weeklyData,
        backgroundColor: a.color + '80',
        borderColor: a.color,
        borderWidth: 1,
        borderRadius: 4,
      }))
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { position: 'bottom', labels: { color: '#8b8ca0', font: { size: 11 }, boxWidth: 12, padding: 16 } } },
      scales: {
        x: { grid: { color: 'rgba(30,31,46,0.5)' }, ticks: { color: '#5c5d70', font: { size: 11 } } },
        y: { grid: { color: 'rgba(30,31,46,0.5)' }, ticks: { color: '#5c5d70', font: { size: 11 } } }
      }
    }
  });

  // Funnels
  renderFunnel(DASHBOARD_FUNNEL, 'funnel-dashboard');

  // Activity feed
  let actHtml = '';
  ACTIVITIES.forEach(a => {
    actHtml += `<div class="activity-item"><div class="activity-time">${a.time}</div><div class="activity-dot" style="background:${a.color}"></div><div class="activity-text"><span class="activity-agent" style="color:${a.color}">${a.agent}</span> ${a.text}</div></div>`;
  });
  document.getElementById('activity-feed').innerHTML = actHtml;

  // Leaderboard
  const sorted = [...AGENTS].sort((a,b) => b.score - a.score);
  let lbHtml = '';
  sorted.forEach((a, i) => {
    lbHtml += `<div class="leader-row">
      <div class="leader-rank" style="color:${i===0?'#f59e0b':i===1?'#8b8ca0':i===2?'#cd7f32':'var(--text-muted)'}">${i+1}</div>
      <div class="leader-avatar" style="background:${a.bg}"><img src="${a.photo}" alt="${a.name}"></div>
      <div class="leader-info"><div class="leader-name">${a.name}</div><div class="leader-role">${a.role}</div></div>
      <div class="leader-score" style="color:${a.color}">${a.score}</div>
      <div class="leader-bar-bg"><div class="leader-bar" style="width:${a.score}%;background:${a.color}"></div></div>
    </div>`;
  });
  document.getElementById('leaderboard').innerHTML = lbHtml;
}

// ===== LINKEDIN SEARCH =====
function openLinkedInSearch() {
  document.getElementById('linkedin-search-panel').style.display = 'block';
}
function closeLinkedInSearch() {
  document.getElementById('linkedin-search-panel').style.display = 'none';
  document.getElementById('linkedin-search-results').style.display = 'none';
}
function resetLinkedInSearch() {
  ['li-search-title','li-search-company','li-search-location','li-search-skills','li-search-tjm','li-search-score'].forEach(id => {
    const el = document.getElementById(id); if(el) el.value = '';
  });
  document.getElementById('linkedin-search-results').style.display = 'none';
  // Reset grid
  const cards = document.querySelectorAll('#linkedin-profiles-grid .profile-card');
  cards.forEach(c => c.style.display = '');
}
function executeLinkedInSearch() {
  const title = (document.getElementById('li-search-title').value || '').toLowerCase();
  const company = (document.getElementById('li-search-company').value || '').toLowerCase();
  const location = (document.getElementById('li-search-location').value || '').toLowerCase();
  const skills = (document.getElementById('li-search-skills').value || '').toLowerCase();
  const tjmMin = parseFloat(document.getElementById('li-search-tjm').value) || 0;
  const scoreMin = parseFloat(document.getElementById('li-search-score').value) || 0;

  const cards = document.querySelectorAll('#linkedin-profiles-grid .profile-card');
  let matchCount = 0;
  LINKEDIN_PROFILES.forEach((p, i) => {
    let match = true;
    if(title && !p.title.toLowerCase().includes(title)) match = false;
    if(company && !p.company.toLowerCase().includes(company)) match = false;
    if(location && !p.location.toLowerCase().includes(location)) match = false;
    if(skills && !p.skills.some(s => s.toLowerCase().includes(skills))) match = false;
    if(tjmMin && p.tjm < tjmMin) match = false;
    if(scoreMin && p.score < scoreMin) match = false;
    if(cards[i]) cards[i].style.display = match ? '' : 'none';
    if(match) matchCount++;
  });

  const resDiv = document.getElementById('linkedin-search-results');
  resDiv.style.display = 'block';
  resDiv.innerHTML = `<div style="display:flex;align-items:center;gap:12px;padding:14px 20px;background:rgba(0,119,181,0.08);border-radius:12px;border:1px solid rgba(0,119,181,0.2)">
    <span class="material-icons-round" style="color:#0077b5;font-size:22px">check_circle</span>
    <div><span style="font-weight:700;color:#0077b5">${matchCount} profil${matchCount > 1 ? 's' : ''}</span> <span style="color:var(--text-secondary)">correspond${matchCount > 1 ? 'ent' : ''} \u00e0 vos crit\u00e8res de recherche</span></div>
  </div>`;
  showToast(`<strong>Recherche LinkedIn</strong> ‚Äî ${matchCount} r\u00e9sultat${matchCount > 1 ? 's' : ''}`);
}
function filterLinkedInProfiles(query) {
  const q = query.toLowerCase();
  const cards = document.querySelectorAll('#linkedin-profiles-grid .profile-card');
  LINKEDIN_PROFILES.forEach((p, i) => {
    if(!cards[i]) return;
    const text = (p.name + ' ' + p.title + ' ' + p.company + ' ' + p.location + ' ' + p.skills.join(' ')).toLowerCase();
    cards[i].style.display = text.includes(q) ? '' : 'none';
  });
}

// ===== SLIDE NAVIGATION =====
const SLIDE_FILES = [
  'presentation_strategie/slide_1_titre.html',
  'presentation_strategie/slide_2_defi.html',
  'presentation_strategie/slide_3_vue_ensemble.html',
  'presentation_strategie/slide_4_openoutreach.html',
  'presentation_strategie/slide_5_fire_enrich.html',
  'presentation_strategie/slide_6_twenty_crm.html',
  'presentation_strategie/slide_7_n8n.html',
  'presentation_strategie/slide_8_comparatif_couts.html',
  'presentation_strategie/slide_9_flux_donnees.html',
  'presentation_strategie/slide_10_plan_deploiement.html',
  'presentation_strategie/slide_11_kpis_roi.html',
  'presentation_strategie/slide_12_conclusion.html'
];
let currentSlide = 0;
function changeSlide(dir) {
  currentSlide = Math.max(0, Math.min(SLIDE_FILES.length - 1, currentSlide + dir));
  const frame = document.getElementById('pres-frame');
  if(frame) frame.src = SLIDE_FILES[currentSlide];
  const counter = document.getElementById('slide-counter');
  if(counter) counter.textContent = (currentSlide + 1) + ' / ' + SLIDE_FILES.length;
}

// ===== INIT =====
buildAllPages();
initDashboardCharts();
renderFunnel(B2B_FUNNEL, 'funnel-b2b');
renderFunnel(B2C_FUNNEL, 'funnel-b2c');
renderPipeline(B2B_PIPELINE, 'b2b-pipeline');
renderPipeline(B2C_PIPELINE, 'b2c-pipeline');
</script>
</body>
</html>
